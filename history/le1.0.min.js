if(Object.getPrototypeOf=Object.getPrototypeOf||function(t){return t.__proto__},Object.setPrototypeOf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},Object.defineProperty||(Object.defineProperty=function(t,i,e){if(!t.__defineGetter__)throw new TypeError("Object.defineProperty not supported");e.get&&t.__defineGetter__(i,e.get),e.set&&t.__defineSetter__(i,e.set)}),"function"!=typeof Object.create&&(Object.create=function(t){var i=function(){};return i.prototype=t,new i}),!Function.prototype.bind){var Empty=function(){};Function.prototype.bind=function(t){var i=this;if("function"!=typeof i)throw new TypeError("Function.prototype.bind called on incompatible "+i);var e=Array.prototype.slice.call(arguments,1),n=function(){if(this instanceof n){var s=i.apply(this,e.concat(Array.prototype.slice.call(arguments)));return Object(s)===s?s:this}return i.apply(t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype&&(Empty.prototype=i.prototype,n.prototype=new Empty,Empty.prototype=null),n}}!function(){function t(t,i,e){Object.keys(e).forEach(function(n){if(i[n]=e[n],"function"!=typeof e[n])throw new TypeError("extend: Method `"+n+"` is not a function");Object.defineProperty(t.prototype,n,{configurable:!0,value:e[n]})})}function i(t,i,e){return t.prototype[i].apply(this,e)}Object.prototype.extend||Object.defineProperty(Object.prototype,"extend",{value:function(){function e(){return this.init.apply(this,arguments),this}var n={},s=Array.prototype.slice.call(arguments,0);if(e.fn=e.prototype=Object.create(this.prototype),s.forEach(function(i){t(e,n,i.__methods__||i)}),!("init"in e.prototype))throw new TypeError("extend: Class is missing a constructor named `init`");return Object.defineProperty(e.prototype,"_super",{value:i}),Object.defineProperty(e,"__methods__",{value:n}),e}})}(),Math.rand=function(t,i){return Math.random()*(i-t)+t},Number.prototype.clamp=function(t,i){return this<t?t:this>i?i:+this},Function.prototype.defer=function(){return setTimeout(this.bind.apply(this,arguments),.01)},function(t){if(!t.leSetAnimateFrameInterval){t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||function(i){return t.setTimeout(i,1e3/60)},t.cancelAnimationFrame=t.cancelAnimationFrame||t.webkitCancelAnimationFrame||t.mozCancelAnimationFrame||t.oCancelAnimationFrame||function(i){t.clearTimeout(i)},t.performance=t.performance||{},t.performance.now=t.performance&&t.performance.now?t.performance.now.bind(t.performance):Date.now?Date.now.bind(Date):function(){return(new Date).getTime()};var i=[];t.leSetAnimateFrameInterval=function(t){i.push(t)};var e=~~t.performance.now(),n=function(){var s=~~t.performance.now(),o=s-e;if(o>0){e=s;for(var r in i)i[r].call(this,o,s)}t.requestAnimationFrame(n)};n()}}(window),window.le=function(){var t={directors:[],timer:null,loader:null,message:null};t._clock=0,t._ticker=0,this._error="",t.NOSWALLOW=2,t.NOINSIDE=4,t.REPLACE=2,t.loadDirector=function(i,e){var n=new le.Director(i,e);return t.directors.push(n),n},t.removeDirector=function(i){for(var e in t.directors)if(t.directors==directors){t.directors[e]._exit(),t.directors.splice(e,1);break}},t.reportError=function(t){console.log(t),this._error=t};var i=[],e=[],n=!1;return t.step={add:function(t){return n?e.push(t):i.push(t),this.run(),this},run:function(){if(n)return this;for(n=!0;i.length>0;)i.shift()(),i=e.concat(i),e=[];n=!1}},window.leSetAnimateFrameInterval(function(i){t._clock+=i,t._ticker++,t.timer&&t.timer._update(i);for(var e in t.directors)t.directors[e].update(i);t.timer&&t.timer._updateAfterAll();for(var e in t.directors)t.directors[e].update(i)}),t}(),function(t,e){!function(){function i(t,i){this.type=t,this.swallowed=!1,this.data=i}i.prototype.swallow=function(){this.swallowed=!0},e.Message=Object.extend({init:function(){this._list={}},listen:function(t,i,e,n){void 0==this._list[i]&&(this._list[i]={lns:[],dirty:0}),this._list[i].lns.push({fn:e,t:t,p:n||0}),this._list[i].dirty=1},unlisten:function(t,i,e){var n=this._list;if(void 0!==i){if(void 0!=n[i])for(var s=0,o=n[i].lns.length;s<o;s++)n[i].lns[s].t!=t||void 0!==e&&e!==n[i].lns[s].fn||(n[i].lns[s].fn=null,n[i].lns.splice(s,1),s--,o--)}else for(var i in n)for(var s=0,o=n[i].lns.length;s<o;s++)n[i].lns[s].t==t&&(n[i].lns[s].fn=null,n[i].lns.splice(s,1),s--,o--)},dispatch:function(t,e){if(void 0!=this._list[t]){var n=this._list[t],s=new i(t,e);n.dirty&&(n.lns.sort(function(t,i){return-(t.p-i.p)}),n.dirty=0);var o=n.lns.slice(0);for(var r in o)if(o[r].fn&&(o[r].fn(s,o[r].t),s.swallowed))break}}}),t._messageSingle=new e.Message,e.message=t._messageSingle}(),e.Director=Object.extend({init:function(t,i){this._error=null,this._clock=0;var n="string"==typeof t?document.getElementById(t):t;this.container=n;var s=n.clientWidth,o=n.clientHeight;this.containerSize={w:s,h:o},this.winSize={w:null,h:null},this.designResolution="SHOW_ALL",i.call(this,s,o),null==this.winSize.w&&(this.winSize.w=this.containerSize.w,this.winSize.h=this.containerSize.h),this.winScale={sx:this.containerSize.w/this.winSize.w,sy:this.containerSize.h/this.winSize.h};var r=document.createElement("canvas");r.style.position="absolute",r.style.left="0",r.style.zIndex="1000",r.style.top="0",r.style.width="100%",r.style.height="100%",r.width=this.winSize.w,r.height=this.winSize.h,n.appendChild(r),this.canvas=r,this._context=r.getContext("2d"),this._cacheCanvas=document.createElement("canvas"),this._cacheCanvas.width=this.winSize.w,this._cacheCanvas.height=this.winSize.h,this._cacheContext=this._cacheCanvas.getContext("2d"),this.world=new e.Layer(this),this.world._enter(this),this._scenes=[],this.debugData={objs:0,draws:0,drawTime:0,updateTime:0,fps:0,updateFps:0,drawFps:0,cfps:0,cfpsCountClock:0,cupdateFps:0,cdrawFps:0},this._isPause=!1,this.cursors=[],this._debugFps=null,this.showError=!1,this._clearBeforeDraw=!0,this._events={},this.initEvent()},setContainerSize:function(t,i){this.containerSize.w=t,this.containerSize.h=i},setDesignResolutionSize:function(t,i,e){this.winSize.w=t,this.winSize.h=i,void 0!==e&&(this.designResolution=e)},_exit:function(){},getContext:function(){return this._context},update:function(i){var e=this.debugData;if(e.cfps++,null!=this.world&&0==this._isPause){var n=t.performance.now();e.cupdateFps++,e.objs=0,this.world.__update(i,this),e.updateTime=t.performance.now()-n,this.world.dirty&&(this._clearBeforeDraw&&(this._context.clearRect(0,0,this.winSize.w,this.winSize.h),this._cacheContext.clearRect(0,0,this.winSize.w,this.winSize.h)),n=t.performance.now(),e.cdrawFps++,e.draws=0,this.world.__draw(this._cacheContext,this,null),this._context.drawImage(this._cacheCanvas,0,0),e.drawTime=t.performance.now()-n)}e.cfpsCountClock+=i,e.cfpsCountClock>=1e3&&(e.updateFps=e.cupdateFps,e.drawFps=e.cdrawFps,e.fps=e.cfps,e.cfpsCountClock-=1e3,e.cfps=0,e.cupdateFps=0,e.cdrawFps=0),this._debugFps&&this._debugFps.__draw(this._context,null,null)},_updateAfterAll:function(){for(var t in this._events)for(var i in this._events[t].v)null==this._events[t].v[i]&&this._events[t].v.splice(i,1)},showFps:function(){this._debugFps=new e.DebugFps(this)},noClearBeforeDraw:function(){this._clearBeforeDraw=!1},initEvent:function(){var t=this,i=[{type:"mouseup",value:["mouseup"]},{type:"mousemove",value:["mousemove"]},{type:"mousedown",value:["mousedown"]},{type:"mousecancel",value:["mouseout"]}];e.device.touch&&(i=[{type:"mouseup",value:["touchend"]},{type:"mousemove",value:["touchmove"]},{type:"mousedown",value:["touchstart"]},{type:"mousecancel",value:["touchcancel"]}]),i.forEach(function(i){i.value.forEach(function(n){t.canvas.addEventListener(n,function(n){var s=t.canvas.getBoundingClientRect(),o=n.clientX,r=n.clientY;void 0!=n.touches&&(n.touches.length>0?(o=n.touches.item(0).clientX,r=n.touches.item(0).clientY):void 0!=n.changedTouches&&n.changedTouches.length>0?(o=n.changedTouches.item(0).clientX,r=n.changedTouches.item(0).clientY):console.log("error",n));var h=new e.MouseEvent(n,(o-s.left)/t.winScale.sx,(r-s.top)/t.winScale.sy,i.type);t.triggerEvent(i.type,h)})})}),["keyup","keypress","keydown"].forEach(function(i){document.addEventListener(i,function(n){var s=new e.KeyboardEvent(n,n.key,n.keyCode,i);t.triggerEvent(i,s)})})},triggerEvent:function(t,i){var e=this._events;if(void 0!==e[t]){e[t].dirty&&(e[t].v=this.sortWithGlobalZorder(e[t].v),e[t].dirty=0);for(var n in e[t].v)if(null!=e[t].v[n]&&e[t].v[n].trigger(t,i),i.swallowed)break}},sortWithGlobalZorder:function(t){var i=[];for(var n in t)null!=t[n]&&i.push({t:t[n],os:t[n].getParentsOrder()});i.sort(function(t,i){for(var n=t.os.length,s=i.os.length,o=0;o<n&&o<s;o++)if(t.os[o]!=i.os[o])return t.os[o]>i.os[o]?-1:1;return e.director.reportError("sortWithGlobalZorder error."),-(n-s)});var s=[];for(var o in i)s.push(i[o].t);return s},_register:function(t,i){var e=this._events;void 0===e[i]&&(e[i]={m:0,v:[],dirty:0}),e[i].v.push(t),e[i].dirty=1},_unregister:function(t,i){var e=this._events;for(var n in e)if(void 0===i||i==n)for(j in e[n].v)e[n].v[j]==t&&(e[n].v[j]=null)},currentScene:function(){return self._scenes>0?self._scenes[self._scenes.length-1]:null},startScene:function(t,i){i=void 0===i?0:i;var n=this;e.step.add(function(){if(n._scenes.length>0){var t=n._scenes[n._scenes.length-1];i&e.REPLACE&&n._scenes.pop(),t._doFinish()}}).add(function(){n._scenes.push(t),t._doStart(n,n.world)})},finishScene:function(t){var i=this;if(i._scenes.length>0){var n=i._scenes.indexOf(t);if(n<0)return!1;n==i._scenes.length-1?e.step.add(function(){i._scenes.pop(),t._doFinish()}).add(function(){i._scenes.length>0&&i._scenes[i._scenes.length-1]._doStart(i,i.world)}):i._scenes.splice(n,1)}},popSceneTo:function(t){if(!(t>=this._scenes.length)){var i=this;e.step.add(function(){this._scenes.length>0&&i._scenes[i._scenes.length-1]._doFinish()}).add(function(){for(;i._scenes.length>t-1;)i._scenes.pop();i._scenes[i._scenes.length-1]._doStart(i,i.world)})}}}),function(){var i=function(t){return t.substring(0,1).toUpperCase()+t.substring(1,t.length)};e.agent=function(){var e={},n=["ms","MS","moz","webkit","o"];return e.prefixed=function(e,s){if(s=s||t,e in s)return s[e];var o,r=i(e);return n.some(function(t){var i=t+r;return o=i in s?s[i]:void 0}),o},e.setPrefixed=function(e,s,o){if(o=o||t,e in o)o[e]=s;else{var r=i(e);n.some(function(t){var i=t+r;return i in o&&(o[i]=s,!0)})}},e}()}(),e.device=function(){function i(t){t.reading?(s.accelerationX=t.reading.accelerationX,s.accelerationY=t.reading.accelerationY,s.accelerationZ=t.reading.accelerationZ):(s.accelerationX=t.accelerationIncludingGravity.x,s.accelerationY=t.accelerationIncludingGravity.y,s.accelerationZ=t.accelerationIncludingGravity.z)}function n(t){s.gamma=t.gamma,s.beta=t.beta,s.alpha=t.alpha}var s={},o=!1,r=!1,h=!0,a=function(i){return i.preventDefault(),t.scroll(0,0),!1};return s._check=function(){e.device._detectDevice(),e.device.isMobile&&!e.device.cocoon&&s.enableSwipe(!1),e.device.pointerEvent=e.agent.prefixed("PointerEvent",t),e.device.maxTouchPoints=e.agent.prefixed("maxTouchPoints",navigator)||0,t.gesture=e.agent.prefixed("gesture"),e.device.touch="createTouch"in document||"ontouchstart"in t||e.device.cocoon||e.device.pointerEvent&&e.device.maxTouchPoints>0,e.device.wheel="onwheel"in document.createElement("div"),e.device.hasAccelerometer=void 0!==t.DeviceMotionEvent||void 0!==t.Windows&&"function"==typeof Windows.Devices.Sensors.Accelerometer,this.hasPointerLockSupport=e.agent.prefixed("pointerLockElement",document),this.hasPointerLockSupport&&(document.exitPointerLock=e.agent.prefixed("exitPointerLock",document)),t.DeviceOrientationEvent&&(e.device.hasDeviceOrientation=!0),this.hasFullscreenSupport=e.agent.prefixed("fullscreenEnabled",document)||document.mozFullScreenEnabled,document.exitFullscreen=e.agent.prefixed("cancelFullScreen",document)||e.agent.prefixed("exitFullscreen",document),navigator.vibrate=e.agent.prefixed("vibrate",navigator);try{s.localStorage=!!t.localStorage}catch(t){s.localStorage=!1}t.addEventListener("blur",function(){},!1),t.addEventListener("focus",function(){},!1);var i,n;void 0!==document.hidden?(i="hidden",n="visibilitychange"):void 0!==document.mozHidden?(i="mozHidden",n="mozvisibilitychange"):void 0!==document.msHidden?(i="msHidden",n="msvisibilitychange"):void 0!==document.webkitHidden&&(i="webkitHidden",n="webkitvisibilitychange"),"string"==typeof n&&document.addEventListener(n,function(){document[i]},!1)},s._detectDevice=function(){e.device.iOS=/iPhone|iPad|iPod/i.test(e.device.ua),e.device.android=/Android/i.test(e.device.ua),e.device.android2=/Android 2/i.test(e.device.ua),e.device.chromeOS=/CrOS/.test(e.device.ua),e.device.wp=/Windows Phone/i.test(e.device.ua),e.device.BlackBerry=/BlackBerry/i.test(e.device.ua),e.device.Kindle=/Kindle|Silk.*Mobile Safari/i.test(e.device.ua),e.device.isMobile=/Mobi/i.test(e.device.ua)||e.device.iOS||e.device.android||e.device.wp||e.device.BlackBerry||e.device.Kindle||!1,e.device.ejecta=void 0!==t.ejecta,e.device.cocoon=navigator.isCocoonJS||void 0!==t.Cocoon},s.ua=navigator.userAgent,s.localStorage=!1,s.hasAccelerometer=!1,s.hasDeviceOrientation=!1,s.hasFullscreenSupport=!1,s.hasPointerLockSupport=!1,s.nativeBase64="function"==typeof t.atob,s.maxTouchPoints=0,s.touch=!1,s.wheel=!1,s.isMobile=!1,s.iOS=!1,s.android=!1,s.android2=!1,s.ejecta=!1,s.cocoon=!1,s.chromeOS=!1,s.wp=!1,s.BlackBerry=!1,s.Kindle=!1,s.orientation=0,s.accelerationX=0,s.accelerationY=0,s.accelerationZ=0,s.gamma=0,s.beta=0,s.alpha=0,s.language=navigator.language||navigator.browserLanguage||navigator.userLanguage||"en",s.enableSwipe=function(i){!1!==i?!1===h&&(t.document.removeEventListener("touchmove",a,!1),h=!0):!0===h&&(t.document.addEventListener("touchmove",a,!1),h=!1)},s.requestFullscreen=function(t){this.hasFullscreenSupport&&((t=t).requestFullscreen=e.agent.prefixed("requestFullscreen",t)||t.mozRequestFullScreen,t.requestFullscreen())},s.exitFullscreen=function(){this.hasFullscreenSupport&&document.exitFullscreen()},s.turnOffPointerLock=function(){this.hasPointerLockSupport&&document.exitPointerLock()},s.watchAccelerometer=function(){if(e.device.hasAccelerometer){if(!o){if("undefined"==typeof Windows)t.addEventListener("devicemotion",i,!1);else{var n=Windows.Devices.Sensors.Accelerometer.getDefault();if(n){var s=n.minimumReportInterval,r=s>=16?s:25;n.reportInterval=r,n.addEventListener("readingchanged",i,!1)}}o=!0}return!0}return!1},s.unwatchAccelerometer=function(){o&&("undefined"==typeof Windows?t.removeEventListener("devicemotion",i,!1):Windows.Device.Sensors.Accelerometer.getDefault().removeEventListener("readingchanged",i,!1),o=!1)},s.watchDeviceOrientation=function(){return e.device.hasDeviceOrientation&&!r&&(t.addEventListener("deviceorientation",n,!1),r=!0),!1},s.unwatchDeviceOrientation=function(){r&&(t.removeEventListener("deviceorientation",n,!1),r=!1)},s.vibrate=function(t){navigator.vibrate&&navigator.vibrate(t)},s}(),e.Timer=function(){this._id=0,this._timers=[]},e.Timer.prototype._update=function(t){for(var i=this._timers,e=i.length-1;e>=0;e--)i[e].id<0&&i.splice(e,1);for(e=0;e<i.length;e++)i[e].id<0||(-1==i[e].n?(i[e].n=0,i[e].c=0):(i[e].n+=t,i[e].c+=t),i[e].n>=i[e].iv&&(i[e].fn(i[e].n,i[e].c),i[e].t>=0&&i[e].c>=i[e].t&&(i[e].id=-1),i[e].n%=i[e].iv))},e.Timer.prototype.setTimeout=function(t,i){i=void 0===i?0:i,this._timers.push({iv:i,c:0,n:-1,t:i,fn:t,id:++this._id})},e.Timer.prototype.setInterval=function(t,i,e){i=void 0===i?-1:i,0!=(e=void 0===e?-1:e)&&this._timers.push({iv:i,c:0,n:-1,t:e<0?-1:e*(i>0?i:1e3/60),fn:t,id:++this._id})},e.Timer.prototype.clearTimer=function(t){for(var i=0,e=this._timers.length;i<e;i++)if(this._timers[i].id==t){this._timers[i].id=-1;break}},function(){e.timer=new e.Timer;var t=[];e.timer.callAfterAll=function(i){t.push(i)},e.timer._updateAfterAll=function(){for(var i=0,e=t.length;i<e;i++)t[i](0,0);t=[]},e.timer.now=function(){return e._clock},e.timer.ticker=function(){return e._ticker}}(),e.loader=function(){function i(t){if(d===u)if(t||r.onload){clearTimeout(f);var e=t||r.onload;setTimeout(function(){e()},300)}else console.error("no load callback defined");else f=setTimeout(function(){i(t)},100)}function e(t,i,e){h[t.name]=new Image,h[t.name].onload=i,h[t.name].onerror=e,"string"==typeof r.crossOrigin&&(h[t.name].crossOrigin=r.crossOrigin),h[t.name].src=t.src+r.nocache}function n(i,e,n){function s(t){a[i.name]=t,"tmx"===i.type&&me.levelDirector.addTMXLevel(i.name)}if(i.data)return s(i.data),void e();var o=new XMLHttpRequest,h=me.utils.getFileExtension(i.src);o.overrideMimeType&&("json"===h?o.overrideMimeType("application/json"):o.overrideMimeType("text/xml")),o.open("GET",i.src+r.nocache,!0),o.ontimeout=n,o.onreadystatechange=function(){if(4===o.readyState)if(200===o.status||0===o.status&&o.responseText){var i=null;switch(h){case"xml":case"tmx":case"tsx":if(me.device.ua.match(/msie/i)||!o.responseXML){if(!t.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");i=(new DOMParser).parseFromString(o.responseText,"text/xml")}else i=o.responseXML;var r=me.TMXUtils.parse(i);switch(h){case"tmx":i=r.map;break;case"tsx":i=r.tilesets[0]}break;case"json":i=JSON.parse(o.responseText);break;default:throw new Error("TMX file format "+h+"not supported !")}s(i),e()}else n()},o.send(null)}function s(t,i,e){var n=new XMLHttpRequest;n.overrideMimeType&&n.overrideMimeType("application/json"),n.open("GET",t.src+r.nocache,!0),n.ontimeout=e,n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status&&n.responseText?(l[t.name]=JSON.parse(n.responseText),i()):e())},n.send(null)}function o(t,i,e){var n=new XMLHttpRequest;n.open("GET",t.src+r.nocache,!0),n.responseType="arraybuffer",n.onerror=e,n.onload=function(){var e=n.response;if(e){for(var s=new Uint8Array(e),o=[],r=0;r<s.byteLength;r++)o[r]=String.fromCharCode(s[r]);c[t.name]=o.join(""),i()}},n.send()}var r={},h={},a={},c={},l={},u=0,d=0,f=0;return r.nocache="",r.onload=void 0,r.onProgress=void 0,r.crossOrigin=void 0,r.onLoadingError=function(t){throw new Error("Failed loading resource "+t.src)},r.setNocache=function(t){r.nocache=t?"?"+~~(1e7*Math.random()):""},r.preload=function(t,e){for(var n=0;n<t.length;n++)u+=r.load(t[n],r.onResourceLoaded.bind(r,t[n]),r.onLoadingError.bind(r,t[n]));void 0!==e&&(r.onload=e),i(e)},r.load=function(t,i,r){switch(t.type){case"binary":return o.call(this,t,i,r),1;case"image":return e.call(this,t,i,r),1;case"json":return s.call(this,t,i,r),1;case"tmx":case"tsx":return n.call(this,t,i,r),1;default:throw new Error("load : unknown or invalid resource type : "+t.type)}},r.unload=function(t){switch(t.type){case"binary":return t.name in c&&(delete c[t.name],!0);case"image":return t.name in h&&("function"==typeof h[t.name].dispose&&h[t.name].dispose(),delete h[t.name],!0);case"json":return t.name in l&&(delete l[t.name],!0);case"tmx":case"tsx":return t.name in a&&(delete a[t.name],!0);default:throw new Error("unload : unknown or invalid resource type : "+t.type)}},r.unloadAll=function(){var t;for(t in c)c.hasOwnProperty(t)&&r.unload({name:t,type:"binary"});for(t in h)h.hasOwnProperty(t)&&r.unload({name:t,type:"image"});for(t in a)a.hasOwnProperty(t)&&r.unload({name:t,type:"tmx"});for(t in l)l.hasOwnProperty(t)&&r.unload({name:t,type:"json"})},r.getTMX=function(t){return(t=""+t)in a?a[t]:null},r.getBinary=function(t){return(t=""+t)in c?c[t]:null},r.getImage=function(t){return(t=""+t)in h?h[t]:null},r.getJSON=function(t){return(t=""+t)in l?l[t]:null},r.getLoadProgress=function(){return d/u},r}(),t.le.SpriteFrame=Object.extend({init:function(t,i){this.image=t,this.frame=i.frame,this.rotated=i.rotated,this.spriteSourceSize=i.spriteSourceSize,this.sourceSize=i.sourceSize}}),e.spriteFrameCache=function(){var t={},i={};return t.add=function(t,n){if("string"==typeof n)i[n]=new e.SpriteFrame(t,{frame:{x:0,y:0,w:t.width,h:t.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:t.width,h:t.height},sourceSize:{w:t.width,h:t.height}});else if("object"==typeof n)for(var s in n.frames)i[s]=new e.SpriteFrame(t,n.frames[s])},t.get=function(t){return t in i?i[t]:null},t}(),e.Sysfont=Object.extend({init:function(t,i,e){this.fontWeight="",this.fontStyle="",this.fontSize=i,this.fontFamily=t,this.color=e,this._font=[this.fontWeight,this.fontStyle,this.fontSize+"px",this.fontFamily].join(" ")},attr:function(t){for(i in t)this[i]=t[i];return this._font=[this.fontWeight,this.fontStyle,this.fontSize+"px",this.fontFamily].join(" "),this},clone:function(t){return(new e.SysFont).attr({fontWeight:this.fontWeight,fontStyle:this.fontStyle,fontSize:this.fontSize,fontFamily:this.fontFamily,color:this.color})},beginMeasure:function(t){t.font=this._font},measure:function(t,i){return t.measureText(i).width},beginDraw:function(t,i,e){t.font=this._font,t.fillStyle=this.color,t.textAlign=i,t.textBaseline=e},fillText:function(t,i,e,n){t.fillText(i,e,n)}}),e.BitmapFont=Object.extend({init:function(t,i){this.fontSize=i,this.fontFamily=t,this._space=0},attr:function(t){for(i in t)this[i]=t[i];return this},setSpace:function(t){this._space=t},clone:function(t){return(new e.BitmapFont).attr({fontSize:this.fontSize,fontFamily:this.fontFamily})},beginMeasure:function(t){},measure:function(t,i){for(var n=0,s=0,o=i.length;s<o;s++){var r=i.charCodeAt(s),h=r.toString(16);r<=255?h="00"+h:r<=4095&&(h="0"+h),h=this.fontFamily+"_"+h+".png";var a=e.spriteFrameCache.get(h);null!=a&&(n+=a.sourceSize.w+this._space)}return n>0&&(n-=this._space),n},beginDraw:function(t,i,e){},fillText:function(t,i,n,s){for(var o=0,r=-this.fontSize/2,h=0,a=i.length;h<a;h++){var c=i.charCodeAt(h),l=c.toString(16);c<=255?l="00"+l:c<=4095&&(l="0"+l),l=this.fontFamily+"_"+l+".png";var u=e.spriteFrameCache.get(l);null!=u&&(t.drawImage(u.image,u.frame.x,u.frame.y,u.frame.w,u.frame.h,o+n+u.spriteSourceSize.x,r+s+u.spriteSourceSize.y,u.spriteSourceSize.w,u.spriteSourceSize.h),o+=u.sourceSize.w+this._space)}}}),e.Node=Object.extend({init:function(){this.x=0,this.y=0,this.w=0,this.h=0,this.anchorX=0,this.anchorY=0,this.opacity=1,this.rotation=0,this.scaleX=1,this.scaleY=1,this._zIndex=0,this.visible=!0,this.dirty=3,this.name=null,this.parent=null,this._director=null,this.children=[],this._cacheContent=0,this._actions=null,this._timer=null,this._msgs=null,this._events=null,this._showBorder=!1},pos:function(t,i){return this.x=t,this.y=i,this.dirty|=1,this},posX:function(t){return this.x=t,this.dirty|=1,this},posY:function(t){return this.y=t,this.dirty|=1,this},scale:function(t,i){return this.scaleX=t,this.scaleY=void 0===i?t:i,this.dirty|=1,this},anchor:function(t,i){return this.anchorX=t,this.anchorY=void 0===i?t:i,this.dirty|=1,this},size:function(t,i){return this.w=t,this.h=i,this.dirty|=2,this},showBorder:function(){return this._showBorder=!0,this.dirty|=1,this},setRotation:function(t){return this.rotation=t,this.dirty|=1,this},setOpacity:function(t){return this.opacity=t,this.dirty|=2,this},setZIndex:function(t){return this._zIndex=t,this.dirty|=1,this},setVisible:function(t){return this.visible=t,this.dirty|=1,this},setName:function(t){return this.name=t,this},contentDirty:function(){return this.dirty|=2,this},outerDirty:function(){return this.dirty|=1,this},_clearDirty:function(){this.dirty=0;for(var t=0;t<this.children.length;t++)e.Node.prototype._clearDirty.call(this.children[t])},getAttr:function(t){if("string"==typeof t)return t;for(var i={},e=0,n=t.length;e<n;e++)i[t[e]]=this[t[e]];return i},cacheContent:function(t,i){return this._cacheContent|=i?3:1,this.__cacheMargin=t||0,0==this.__cacheMargin&&(this._cacheContent|=4),this.dirty|=2,this},clip:function(t){return this._cacheContent|=8,t&&(this._cacheContent|=16),this.dirty|=2,this},enableClipInherit:function(){return this._cacheContent|=32,this.dirty|=2,this},appendTo:function(t){return t.addChild(this),this},addChild:function(){for(var t=0;t<arguments.length;t++){for(var i=!1,e=this.children.length-1;e>=0;e--)if(this.children[e]._zIndex<=arguments[t]._zIndex){this.children.splice(e+1,0,arguments[t]),i=!0;break}if(0==i&&this.children.unshift(arguments[t]),null!==arguments[t].parent)throw new Error("add failed since parent is not null.");arguments[t].parent=this,this.isRunning()&&arguments[t]._enter(this._director),null!=this._upnodes&&this._upnodes.push(arguments[t])}return this.dirty|=2,this},removeAllChildren:function(){for(var t=this.children.length-1;t>=0;t--)this.isRunning()&&this.children[t]._exit(),this.children[t].parent=null;return this.children=[],this.dirty|=2,this},removeChild:function(t){if("string"==typeof t){for(e=0;e<this.children.length;e++)if(this.children[e].name==t){var i=this.children[e];this.children.splice(e,1),this.isRunning()&&i._exit(),i.parent=null;break}}else for(var e=0;e<this.children.length;e++)if(this.children[e]==t){this.children.splice(e,1),this.isRunning()&&t._exit(),t.parent=null;break}return this.dirty|=2,this},removeFromParent:function(){this.parent&&this.parent.removeChild(this)},isRunning:function(){return null!=this._director},_enter:function(t){if(this._director=t,null!=this._events)for(var i in this._events)t._register(this,i);if(null!=this._msgs)for(var n in this._msgs)for(var s in this._msgs[n])null!=this._msgs[n][s].fn&&e.message.listen(this,n,this._msgs[n][s].fn,this._msgs[n][s].p);for(var o=this.children.slice(0),i=0,r=o.length;i<r;i++)o[i]._enter(t)},_exit:function(){for(var t=this.children.slice(0),i=0,n=t.length;i<n;i++)t[i]._exit();if(null!=this._msgs)for(var s in this._msgs)e.message.unlisten(this,s);if(null!=this._events)for(var i in this._events)this._director._unregister(this,i);this._director=null},__update:function(t,i){if(i&&i.debugData.objs++,null!=this._timer&&this._timer._update(t),null!=this._actions)for(var n=this._actions,s=0;s<n.length;s++)null!=n[s]&&n[s].isRunning()?(n[s].update(t),n[s].isDone()&&(n[s].stop(),n.splice(s,1),s--)):(n.splice(s,1),s--);this._upnodes=this.children.slice(0);for(s=0;s<this._upnodes.length;s++)this._upnodes[s].parent==this&&(e.Node.prototype.__update.call(this._upnodes[s],t,i),this._upnodes[s].dirty&&(this.dirty|=2))},draw:function(t){},__draw:function(t,i,n){if(0!=this.visible){if(i&&i.debugData.draws++,1!=this.scaleX||1!=this.scaleY||0!=this.rotation)t.save(),t.translate(this.x,this.y),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY),0!=this.rotation&&t.rotate(this.rotation*Math.PI/180),t.translate(-this.anchorX*this.w,-this.anchorY*this.h),n=null;else{if(null!==n&&(this.x-this.anchorX*this.w>n.right||this.y-this.anchorY*this.h>n.bottom||this.x+this.anchorX*this.w<n.left||this.y+this.anchorY*this.h<n.top))return void this._clearDirty();t.save(),t.translate(this.x-this.anchorX*this.w,this.y-this.anchorY*this.h)}if(1!=this.opacity&&(t.globalAlpha*=this.opacity),16&this._cacheContent)n={left:0,top:0,right:this.w,bottom:this.h};else if(null!=n&&32&this._cacheContent){var s=this.x-this.anchorX*this.w,o=this.y-this.anchorY*this.h;n.left-=s,n.top-=o,n.bottom-=o,n.right-=s}else n=null;if((2&this.dirty)>0&&1&this._cacheContent&&this.w>0&&this.h>0){var r=this.__cacheMargin;void 0===this.__cacheCanvas&&(this.__cacheCanvas=this.__createCanvas(this.w+2*r,this.h+=2*r),this.dirty|=2);var h=this.__cacheCanvas,a=this.w+2*r,c=this.h+2*r;h.width!=a||h.height!=c?(h.width=a,h.height=c):(2&this._cacheContent)>0&&h.getContext("2d").clearRect(0,0,h.width,h.height);var l=h.getContext("2d");r>0&&l.translate(r,r);for(var u=0,d=this.children.length;u<d;u++)this.children[u]._zIndex>=0||e.Node.prototype.__draw.call(this.children[u],l,i,n);l.save(),this.draw(l),l.restore(),this._showBorder&&(l.save(),l.strokeStyle="#f00",l.lineWidth=1,l.strokeRect(0,0,this.w,this.h),l.restore());for(var u=0,d=this.children.length;u<d;u++)this.children[u]._zIndex<0||e.Node.prototype.__draw.call(this.children[u],l,i,n)}if(1&this._cacheContent&&this.w>0&&this.h>0)8==(12&this._cacheContent)&&(t.beginPath(),t.moveTo(0,0),t.lineTo(0,this.h),t.lineTo(this.w,this.h),t.lineTo(this.w,0),t.clip()),t.drawImage(this.__cacheCanvas,-this.__cacheMargin,-this.__cacheMargin);else{for(var u=0,d=this.children.length;u<d;u++)this.children[u]._zIndex>=0||e.Node.prototype.__draw.call(this.children[u],t,i,n);8==(8&this._cacheContent)&&(t.beginPath(),t.moveTo(0,0),t.lineTo(0,this.h),t.lineTo(this.w,this.h),t.lineTo(this.w,0),t.clip()),t.save(),this.draw(t),t.restore(),this._showBorder&&(t.save(),t.strokeStyle="#f00",t.lineWidth=1,t.strokeRect(0,0,this.w,this.h),t.restore());for(var u=0,d=this.children.length;u<d;u++)this.children[u]._zIndex<0||e.Node.prototype.__draw.call(this.children[u],t,i,n)}t.restore(),this.dirty=0}else this._clearDirty()},__createCanvas:function(t,i){var e=document.createElement("canvas");return e.width=t,e.width=i,e},setInterval:function(t,i,n){return null==this._timer&&(this._timer=new e.Timer),this._timer.setInterval(t,i,n)},setTimeout:function(t,i){return null==this._timer&&(this._timer=new e.Timer),this._timer.setTimeout(t,i)},clearTimer:function(t){return null!=this._timer&&this._timer.clearTimer(t),this},getParentsOrder:function(){for(var t=[],i=this;null!=i.parent;){var e=i.parent.children.indexOf(i)+1;t.unshift(i._zIndex>=0?e:-1e8+e),i=i.parent}return t.push(0),t},convertToLocal:function(t){var i=[],e=this,n={x:t.x,y:t.y};for(i.unshift(e);null!=e.parent;)i.unshift(e.parent),e=e.parent;for(var s in i)n.x=n.x-i[s].x,n.y=n.y-i[s].y,1!=i[s].scaleX&&(n.x=0!=i[s].scaleX?n.x/Math.abs(i[s].scaleX):1e9),1!=i[s].scaleY&&(n.y=0!=i[s].scaleY?n.y/Math.abs(i[s].scaleY):1e9),n.x+=i[s].anchorX*i[s].w,n.y+=i[s].anchorY*i[s].h;return n},getWorldBound:function(t){t=void 0===t?{x:0,y:0,w:this.w,h:this.h}:t;var i={x:this.x-(this.anchorX*t.w-t.x)*Math.abs(this.scaleX),y:this.y-(this.anchorY*t.h-t.y)*Math.abs(this.scaleY),w:t.w*Math.abs(this.scaleX),h:t.h*Math.abs(this.scaleY)};return this.parent?this.parent.getWorldBound(i):i},bind:function(t,i,e){null==this._events&&(this._events={}),t=t.split(" ");for(var n in t)"click"==t[n]&&this._initClickEvent(),void 0===this._events[t[n]]&&(this._events[t[n]]=[]),this._events[t[n]].push({fn:i,m:void 0===e?0:e,p:0}),this.isRunning()&&this._director._register(this,t[n]);return this},unbind:function(t,i){t=t.split(" ");for(var e in t)if(void 0!==this._events[t[e]])for(var n in this._events[t[e]])this._events[t[e]][n].fn===i&&(this._events[t[e]][n].fn=null);return this},unbindAll:function(t){},trigger:function(t,i){var n=this._events[t];if(n)for(var s=0,o=n.length;s<o;s++)if(null!=n[s].fn){if(0==t.indexOf("mouse")&&0==(n[s].m&e.NOINSIDE)){if(0==this.visible)continue;var r=this.getWorldBound();if(i.x<r.x||i.y<r.y||i.x>r.x+r.w||i.y>r.y+r.h)continue}n[s].fn(i)}else n.splice(s,1),s--,o--},_initClickEvent:function(){if(!("_isInitedClickEvent"in this&&this._isInitedClickEvent)){this._isInitedClickEvent=!0;var t=this,i=!1,n=!1,s=0,o=0;this.bind("mousedown",function(t){i=!0,n=!0,s=t.x,o=t.y}),this.bind("mousemove",function(t){i&&(n&&(Math.abs(s-t.x)>20&&(n=!1),Math.abs(o-t.y)>20&&(n=!1)),t.swallow())},e.NOINSIDE),this.bind("mouseup mousecancel",function(r){i&&(r.swallow(),n&&"mouseup"==r.type&&t.trigger("click",new e.MouseEvent(r,r.x,r.y,"click")),i=!1,n=!1,s=0,o=0)},e.NOINSIDE)}},listen:function(t,i,n){null==this._msgs&&(this._msgs={}),types=t.split(" ");for(var s in types)void 0===this._msgs[types[s]]&&(this._msgs[types[s]]=[]),this._msgs[types[s]].push({fn:i,p:n||0}),this.isRunning()&&e.message.listen(this,types[s],i,n);return this},unlisten:function(t,i){if(void 0!==this._msgs[t])if(void 0===i)e.message.unlisten(this,t);else for(var n in this._msgs[t])this._msgs[t][n].fn===i&&(this._msgs[t][n].fn=null,this.isRunning()&&e.message.unlisten(this,t,i));return this},unlistenAll:function(){e.message.unlisten(this),this._msgs=[]},runAction:function(t){null==this._actions&&(this._actions=[]),this._actions.push(t),t.start(this)},stopAction:function(t){if(null!=this._actions)for(var i=0,e=this._actions.length;i<e;i++)this._actions[i]==t&&(this._actions[i].stop(),this._actions[i]=null)},stopAllAction:function(){if(null!=this._actions)for(var t=0,i=this._actions.length;t<i;t++)this._actions[t].stop(),this._actions[t]=null}}),e.Layer=e.Node.extend({init:function(t){e.Node.prototype.init.call(this),this.w=t.winSize.w,this.h=t.winSize.h}}),e.LayerColor=e.Node.extend({init:function(t,i){e.Node.prototype.init.call(this),this.w=i.winSize.w,this.h=i.winSize.h,this.color=t},draw:function(t){t.fillStyle=this.color,t.fillRect(0,0,this.w,this.h)}}),e.Sprite=e.Node.extend({init:function(t){e.Node.prototype.init.call(this),this.frame=e.spriteFrameCache.get(t),null!=this.frame&&(this.w=this.frame.sourceSize.w,this.h=this.frame.sourceSize.h),this.anchorX=.5,this.anchorY=.5},draw:function(t){var i=this.frame;null!=i&&t.drawImage(i.image,i.frame.x,i.frame.y,i.frame.w,i.frame.h,i.spriteSourceSize.x,i.spriteSourceSize.y,i.spriteSourceSize.w,i.spriteSourceSize.h)}}),e.Label=e.Node.extend({init:function(t,i){e.Node.prototype.init.call(this),this.text=t,this.font=i,this.lineHeight=-1,this.textAlign="left",this.anchorX=.5,this.anchorY=.5,this._dw=0,this._dh=0,this._lines=[],this._measure()},_measure:function(){var t=this.lineHeight>0?this.lineHeight:this.font.fontSize,i=this.font.fontSize,n=e.Label._measureContext;n.save(),this.font.beginMeasure(n);var s=(""+this.text).split("\n");this._lines=[];var o=0;for(var r in s)if(this._dw>0&&s[r].length*i>this._dw)for(var h=s[r];h.length>0;){var a=this._divstr(n,h,this._dw,i,.6*i);this._lines.push(a.s1),h=a.s2,a.w>o&&(o=a.w)}else{this._lines.push(s[r]);var c=this.font.measure(n,s[r]);c>o&&(o=c)}n.restore(),this.w=o,this.h=t*this._lines.length,this._dh>0&&(this.h=this._dh),this._dw>0&&(this.w=this._dw)},_divstr:function(t,i,e,n,s){for(var o=e-s,r=0,h=i.length,a=0,c=0,l=0,u=i.charCodeAt(r)>127?n:s;r+1<h;r++)if(i.charCodeAt(r+1)>127){if(u+n>=e)break;u+=n}else{if(u+s>=e)break;u+=s}for(;;){if(++c>=20)break;if(a=i.substr(0,r+1),u=this.font.measure(t,a),-1==l&&u<=e)break;if(u>=o&&u<=e)break;if(u<o){if(r>=h-1)break;if(c>=3){r++;continue}do{r++,u+=i.charCodeAt(r)>127?n:s}while(r<h&&u<=o)}else{if(r<=1)break;if(c>=3)r--,l=-1;else do{r--,u-=i.charCodeAt(r)>127?n:s}while(r>0&&u>e)}}return{w:u,pos:r,s1:a,s2:i.substr(r+1)}},setTextAlign:function(t){return this.textAlign=t,this.dirty|=2,this},setText:function(t){return this.text=t,this.dirty|=2,this._measure(),this},setFont:function(t){return this.font=t,this.dirty|=2,this._measure(),this},setLineHeight:function(t){return this.lineHeight=t,this.dirty|=2,this._measure(),this},setDimension:function(t,i){return this._dw=t,this._dh=i,this.dirty|=2,this._measure(),this},draw:function(t){var i="left"==this.textAlign?0:"right"==this.textAlign?this.w:this.w/2,e=this.lineHeight>0?this.lineHeight:this.font.fontSize,n=e/2;this.font.beginDraw(t,this.textAlign,"middle");for(var s=0;s<this._lines.length;s++)this.font.fillText(t,this._lines[s],i,n),n+=e}}),e.Label._measureCanvas=document.createElement("canvas"),e.Label._measureContext=e.Label._measureCanvas.getContext("2d"),e.Button=e.Node.extend({init:function(t,i,n){e.Node.prototype.init.call(this),this.anchorX=.5,this.anchorY=.5,this.enable=!0;var s=null,o=null,r=null;s="string"==typeof t?new e.Sprite(t):t instanceof e.Node?t:new e.Node,"string"==typeof i?o=new e.Sprite(i):i instanceof e.Node&&(o=i),"string"==typeof n?r=new e.Sprite(n):n instanceof e.Node&&(r=n),this.w=s.w,this.h=s.h,s.anchorX=.5,s.anchorY=.5,s.x=this.w/2,s.y=this.h/2,this.addChild(s),null!=o&&(o.anchorX=.5,o.anchorY=.5,o.x=this.w/2,o.y=this.h/2,o.setVisible(!1),this.addChild(o)),null!=r&&(r.anchorX=.5,r.anchorY=.5,r.x=this.w/2,r.y=this.h/2,r.setVisible(!1),this.addChild(r)),this.normal=s,this.pressed=o,this.disabled=r,this._initClickEvent()},setEnable:function(t){return this.enable=t,this.dirty|=1,this},size:function(t,i){return this.w=t,this.h=i,this.normal.x=this.w/2,this.normal.y=this.h/2,null!=this.pressed&&(this.pressed.x=this.w/2,this.pressed.y=this.h/2),null!=this.disabled&&(this.disabled.x=this.w/2,this.disabled.y=this.h/2),this.dirty|=2,this},_initClickEvent:function(){if(!("_isInitedClickEvent"in this&&this._isInitedClickEvent)){this._isInitedClickEvent=!0;var t=this,i=!1,n=!1,s=0,o=0;this.bind("mousedown",function(e){i=!0,n=!0,s=e.x,o=e.y,t.enable&&t.pressed&&(t.pressed.setVisible(!0),t.normal&&t.normal.setVisible(!1))}),this.bind("mousemove",function(t){i&&(n&&(Math.abs(s-t.x)>20&&(n=!1),Math.abs(o-t.y)>20&&(n=!1)),t.swallow())},e.NOINSIDE),this.bind("mouseup mousecancel",function(r){i&&(r.swallow(),t.enable&&t.pressed&&(t.pressed.setVisible(!1),t.normal&&t.normal.setVisible(!0)),t.enable&&n&&"mouseup"==r.type&&t.trigger("click",new e.MouseEvent(r,r.x,r.y,"click")),i=!1,n=!1,s=0,o=0)},e.NOINSIDE)}}}),function(){var t=e.Node.extend({init:function(t){e.Node.prototype.init.call(this),this.show=!1,this.hide=!1,this.font=t,this.w=1,this.h=this.font.fontSize,this.clock=0;var i=this;this.setInterval(function(t,e){if(0!=i.show){i.clock+=t;var n=i.clock%1200>600;i.hide!=n&&(i.dirty|=2,i.hide=n)}})},startShow:function(){return this.show=!0,this.dirty|=1,console.log("startShow"),this},stopShow:function(){return this.show=!1,this.dirty|=1,console.log("stopShow"),this},draw:function(t){0==this.show||this.hide||(t.fillStyle=this.font.color,t.fillRect(0,0,this.w,this.h))}});e.Input=e.Node.extend({init:function(i){e.Node.prototype.init.call(this),this.label=new e.Label("",i),this.label.anchor(0,.5).pos(0,this.h/2).appendTo(this),this.cursor=new t(i),this.cursor.anchor(.5,.5).pos(0,this.h/2).appendTo(this),this.placeLabel=null,this.__input=null;var n=this;this.setInterval(function(t){n.update(t)}),this.bind("click",function(){n.focus()}),this.bind("mousedown",function(t){n.blur()},e.NOINSIDE),this._lastX=0,this._lastY=0,this._lastW=0,this._lastH=0},_enter:function(t){e.Node.prototype._enter.call(this,t),this.__initHtml()},_exit:function(){this._director.container.removeChild(this.__input),this.__input=null,e.Node.prototype._exit.call(this)},__initHtml:function(){var t=document.createElement("input");t.style.position="absolute",t.style.width=10,t.style.fontSize=this.label.font.fontSize+"px";var i=this;t.addEventListener("blur",function(){i.cursor.stopShow()}),t.addEventListener("focus",function(){i.cursor.startShow()}),this._director.container.appendChild(t),this.__input=t},__setHtmlPos:function(t,i,e){this.__input.style.left=t,this.__input.style.top=i},update:function(t){if(null!=this.__input&&(this.label.text!=this.__input.value&&(this.label.setText(this.__input.value),this.cursor.posX(this.label.w),this.label.w>this.w&&this.size(this.label.w,this.h)),this._lastH!=this.h&&(this.label.posY(this.h/2),this.cursor.posY(this.h/2)),this._lastW!=this.w||this._lastH!=this.h||this._lastX!=this.x||this._lastY!=this.y)){var i=this.h/2+this.label.h/2,e=this.getWorldBound({x:0,y:i,w:this.w,h:this.h-i}),n=this._director.winScale;this.__setHtmlPos(e.x*n.sx,e.y*n.sy,e.w*n.sx),this._lastW=this.w,this._lastX=this.x,this._lastY=this.y,this._lastH=this.h}},setPlaceholder:function(t,i){this.placeLabel&&this.removeChild(this.placeLabel),this.placeLabel=new e.Label(t,i),this.dirty|=2},setText:function(t){this.label.setText(t)},focus:function(){this.__input.focus(),this.__input.value=this.label.text,this.cursor.startShow()},blur:function(){this.__input.blur(),this.cursor.stopShow()}})}(),e.Video=e.Node.extend({init:function(t){e.Node.prototype.init.call(this),this.source=t,this.__video=null;var i=this;this.setInterval(function(t){i.update(t)},1/30)},__initHtml:function(){var t=document.createElement("video");t.src=this.source,t.style.position="absolute",t.style.width=320,t.style.height=100,t.style.left="100px",t.style.top="100px";this._director.container.appendChild(t),this.__video=t},_enter:function(t){e.Node.prototype._enter.call(this,t),this.__initHtml()},_exit:function(){this._director.container.removeChild(this.__video),this.__video=null,e.Node.prototype._exit.call(this)},play:function(){null!=this.__video&&this.__video.play()},pause:function(){null!=this.__video&&this.__video.pause()},update:function(t){this.dirty|=2},draw:function(t){this.__video&&t.drawImage(this.__video,0,0,this.w,this.h)}}),e.Image=e.Node.extend({init:function(t){e.Node.prototype.init.call(this),this.anchorX=.5,this.anchorY=.5,this.src=t,this.image=new Image,this.status=0,this._autoSize=!0;var i=this;this.image.onload=function(){i.status=1,i._autoSize&&e.Node.prototype.size.call(i,i.image.width,i.image.height)},this.image.onerror=function(){i.status=-1,e.reportError("error image: "+i.src)},this.image.src=t},size:function(t,i){return e.Node.prototype.size.call(this,t,i),this._autoSize=!1,this},draw:function(t){this.status>0&&t.drawImage(this.image,0,0,this.w,this.h)}}),e.Scene=Object.extend({init:function(){this._indent={},this._data={},this.root=null,this._status="INITED",this._from="PUSH_IN",this._todoTasks=0,this.director=null},setIntent:function(t,i){this._indent[t]=i},getIntent:function(t){return this._indent[t]},etData:function(t,i){this._data[t]=i},getData:function(t){return this._data[t]},_doStart:function(t,i){this.director=t,null!=this.root&&this.root.removeFromParent(),this.root=new e.Layer(this.director),this.root.bind("mouseup mousedown mousemove mousecancel",function(t){t.swallow()}),i.addChild(this.root),this._status="LOADING",this.incTask();var n=this;e.step.add(function(){n.willLoad()}).add(function(){n.decTask()})},_doFinish:function(){if("FINISHED"!=this._status&&"FINISHING"!=this._status){this._status="FINISHING";var t=this;e.step.add(function(){"FINISHING"==t._status&&t.willExit()}).add(function(){"FINISHING"==t._status&&(null!=t.root&&(t.root.removeFromParent(),t.root=null),this._status="FINISHED",t.didExit())})}},incTask:function(){this._todoTasks++},decTask:function(){for(this._todoTasks--;this._todoTasks<=0&&"LOADING"==this._status;){var t=this;this._status="LOADED",e.step.add(function(){"LOADED"==t._status&&t.didLoad()}).add(function(){"LOADED"==t._status&&(t.willEnter(),t._status="RUNNING")}).add(function(){"RUNNING"==t._status&&t.didEnter()})}},finish:function(){null!=this.director?this.director.finishScene(this):e.director.reportError("finish with no start")},finishWithResult:function(){},willLoad:function(){},didLoad:function(){},willEnter:function(){},didEnter:function(){},willExit:function(){},didExit:function(){}}),e.Action=Object.extend({init:function(){},isRunning:function(){return!1},stop:function(){},start:function(){}}),e.ActionInterval=e.Action.extend({init:function(t){this.duration=t,this.clock=0,this.target=null,this.fc=!0},getDuration:function(){return this.duration},start:function(t){this.target=t,this.clock=0,this.fc=!0},isDone:function(){return this.clock>=this.duration},stop:function(){this.target=null},isRunning:function(){return null!=this.target},update:function(t){if(null!=this.target)if(this.fc?(this.fc=!1,this.clock=0):this.clock+=t,this.duration>0){var i=this.clock/this.duration;i>1?i=1:i<0&&(i=0),this.step(i)}else this.step(this.clock>0?1:0)},step:function(t){}});var n=e.ActionInterval,s=n.prototype.init,o=n.prototype.start;e.ActionEasy=n.extend({init:function(t){s.call(this,t.duration),this.inner=t},start:function(t){o.call(this,t),this.inner.start(this.target)},stop:function(){n.prototype.stop.call(this),this.inner.stop()},step:function(t){this.inner.step(t)}}),e.Seq=n.extend({init:function(t){for(var i=t instanceof Array?t:Array.prototype.slice.call(arguments,0),e=0,n=0,o=i.length;n<o;n++)e+=i[n].duration;s.call(this,e),this._actions=i,this._last=-1,this.ld=0,this.fc=!0},start:function(t){o.call(this,t),this._last=-1,this.ld=0,this.fc=!0},stop:function(){-1!=this._last&&this._actions[this._last].stop(),n.prototype.stop.call(this)},update:function(t){var i=this._actions,e=this._last;if(this.fc){if(this.fc=!1,this.clock=0,this.ld=0,!(i.length>0))return;i[0].start(this.target),i[0].update(0),e=0}else this.clock+=t,this.ld+=t,-1!=e&&i[e].update(t);for(;-1!=e&&0!=i[e].isDone();){if(i[e].stop(),e+1>=i.length){e=-1;break}if(this.ld-=i[e].duration,e++,i[e].start(this.target),i[e].update(0),this.ld>0){if(i[e].isDone())continue;i[e].update(this.ld)}}this._last=e}}),e.Spwan=n.extend({init:function(t){for(var i=t instanceof Array?t:Array.prototype.slice.call(arguments,0),e=0,n=0,o=i.length;n<o;n++)i[n].duration>e&&(e=i[n].duration);this._actions=i,s.call(this,e)},update:function(t){this.fc?(this.fc=!1,this.clock=0):this.clock+=t;for(var i=this._actions,e=0,n=i.length;e<n;e++)0!=i[e].isRunning()&&(i[e].update(t),i[e].isDone()&&i[e].stop())},start:function(t){o.call(this,t);for(var i=0,e=this._actions.length;i<e;i++)this._actions[i].start(t)}}),e.RepeatForever=n.extend({init:function(t){s.call(this,t.duration),this._inner=t,this.ld=0},isDone:function(){return!1},start:function(t){o.call(this,t),this._inner.start(t),this.ld=0},update:function(t){var i=this._inner;this.fc?(this.fc=!1,this.clock=0,this.ld=0,t=0,i.start(this.target),i.update(0)):(this.clock+=t,this.ld+=t,i.update(t)),i.isDone()&&(i.stop(),i.start(this.target),i.update(0),this.ld=this.ld-this.duration,this.ld>0&&0==i.isDone()&&i.update(this.ld))}}),e.MoveBy=n.extend({init:function(t,i,e){s.call(this,t),this.dx=i,this.dy=e},start:function(t){o.call(this,t),this.x=t.x,this.y=t.y},step:function(t){this.target.pos(this.x+this.dx*t,this.y+this.dy*t)}}),e.MoveTo=n.extend({init:function(t,i,e){s.call(this,t),this.dx=i,this.dy=e},start:function(t){o.call(this,t),this.x=t.x,this.y=t.y,this.dx=this.dx-this.x,this.dy=this.dy-this.y},step:function(t){this.target.pos(this.x+this.dx*t,this.y+this.dy*t)}}),e.MoveXBy=n.extend({init:function(t,i){s.call(this,t),this.dx=i},start:function(t){o.call(this,t),this.x=t.x},step:function(t){this.target.posX(this.x+this.dx*t)}}),e.MoveXTo=n.extend({init:function(t,i){s.call(this,t),this.dx=i},start:function(t){o.call(this,t),this.x=t.x,this.dx=this.dx-this.x},step:function(t){this.target.posX(this.x+this.dx*t)}}),e.MoveYBy=n.extend({init:function(t,i){s.call(this,t),this.dy=i},start:function(t){o.call(this,t),this.y=t.y},step:function(t){this.target.posY(this.y+this.dy*t)}}),e.MoveYTo=n.extend({init:function(t,i){s.call(this,t),this.dy=y},start:function(t){o.call(this,t),this.y=t.y,this.dy=this.dy-this.y},step:function(t){this.target.posY(this.y+this.dy*t)}}),e.ScaleBy=n.extend({init:function(t,i,e){s.call(this,t),this.dsx=i,this.dsy=void 0===e?i:e},start:function(t){o.call(this,t),this.sx=t.scaleX,this.sy=t.scaleY,this.dsx=this.dsx*this.sx-this.sx,this.dsy=this.dsy*this.sy-this.sy},step:function(t){this.target.scale(this.sx+this.dsx*t,this.sy+this.dsy*t)}}),e.ScaleTo=n.extend({init:function(t,i,e){s.call(this,t),this.dsx=i,this.dsy=void 0===e?i:e},start:function(t){o.call(this,t),this.sx=t.scaleX,this.sy=t.scaleY,this.dsx=this.dsx-this.sx,this.dsy=this.dsy-this.sy},step:function(t){this.target.scale(this.sx+this.dsx*t,this.sy+this.dsy*t)}}),e.RotateTo=n.extend({init:function(t,i){s.call(this,t),this.dag=i},start:function(t){o.call(this,t),this.ag=t.rotation%360,this.dag=this.dag-this.ag,this.dag>180?this.dag-=360:this.dag<-180&&(this.dag+=360)},step:function(t){this.target.setRotation(this.ag+this.dag*t)}}),e.RotateBy=n.extend({init:function(t,i){s.call(this,t),this.dag=i},start:function(t){o.call(this,t),this.ag=t.rotation},step:function(t){this.target.setRotation(this.ag+this.dag*t)}}),e.JumpBy=n.extend({init:function(t,i,e,n,o){s.call(this,t),this.dx=i,this.dy=e,this.h=-n,this.jumps=o},start:function(t){o.call(this,t),this.x=t.x,this.y=t.y},step:function(t){var i=t*this.jumps%1,e=4*this.h*i*(1-i);e+=this.dy*t,this.target.pos(this.dx*t+this.x,this.y+e)}}),e.JumpTo=e.JumpBy.extend({init:function(t,i,n,s,o){e.JumpBy.prototype.init.call(this,t,i,n,s,o)},start:function(t){e.JumpBy.prototype.start.call(this,t),this.dx=this.dx-this.x,this.dy=this.dy-this.y}}),e.Blink=n.extend({init:function(t,i){s.call(this,t),this.times=i},start:function(t){o.call(this,t),this.origin=t.visible},stop:function(){this.target.setVisible(this.origin),n.prototype.stop.call(this)},step:function(t){var i=1/this.times,e=t%i;this.target.setVisible(e>i/2)}}),e.Delay=n.extend({}),e.FadeTo=n.extend({init:function(t,i){s.call(this,t),this.dopa=i},start:function(t){o.call(this,t),this.opa=t.opacity,this.dopa=this.dopa-this.opa},step:function(t){this.target.setOpacity(this.opa+this.dopa*t)}}),e.ValueTo=n.extend({init:function(t,i,e,n){s.call(this,t),this.from=i,this.to=e,this.callback=n},step:function(t){this.callback(this.from+t*(this.to-this.from),this.target)}}),e.ActionInstant=e.Action.extend({init:function(){this.target=null,this.clock=0,this.duration=0},start:function(t){this.target=t,this.clock=0},isDone:function(){return!0},stop:function(){this.target=null},isRunning:function(){return null!=this.target},update:function(t){},step:function(t){}});var r=e.ActionInstant;e.Show=r.extend({update:function(t){this.target.setVisible(!0)}}),e.Hide=r.extend({update:function(t){this.target.setVisible(!1)}}),e.Place=r.extend({init:function(t,i){r.prototype.init.call(this),this.x=t,this.y=i},update:function(t){this.target.pos(this.x,this.y)}}),e.Callfunc=r.extend({init:function(t){r.prototype.init.call(this),this.func=t},update:function(t){this.func.call(this.target)}}),e.RemoveSelf=r.extend({update:function(t){this.target.removeFromParent()}});var h=e.ActionEasy,a=e.ActionEasy.prototype.init;e.EasyIn=h.extend({init:function(t,i){a.call(this,t),this.rate=void 0===i?2:i},step:function(t){this.inner.step(Math.pow(t,this.rate))}}),e.EasyOut=h.extend({init:function(t,i){a.call(this,t),this.rate=void 0===i?2:i},step:function(t){this.inner.step(Math.pow(t,1/this.rate))}}),e.EasyInOut=h.extend({init:function(t,i){a.call(this,t),this.rate=void 0===i?2:i},step:function(t){(t*=2)<1?this.inner.step(.5*Math.pow(t,this.rate)):this.inner.step(1-.5*Math.pow(2-t,this.rate))}}),e.EaseExponentialIn=h.extend({step:function(t){t=0==t?0:Math.pow(2,10*(t/1-1))-.001,this.inner.step(t)}}),e.EaseExponentialOut=h.extend({step:function(t){t=1==t?1:1-Math.pow(2,-10*t/1),this.inner.step(t)}}),e.EaseExponentialInOut=h.extend({step:function(t){t=(t/=.5)<1?.5*Math.pow(2,10*(t-1)):.5*(2-Math.pow(2,-10*(t-1))),this.inner.step(t)}}),e.EaseSineIn=h.extend({step:function(t){t=-1*Math.cos(t*Math.PI/2)+1,this.inner.step(t)}}),e.EaseSineOut=h.extend({step:function(t){t=Math.sin(t*Math.PI/2),this.inner.step(t)}}),e.EaseSineInOut=h.extend({step:function(t){t=-.5*(Math.cos(t*Math.PI)-1),this.inner.step(t)}}),e.EaseElasticIn=h.extend({init:function(t,i){a.call(this,t),this.period=void 0===i?.3:i},step:function(t){var i=0;if(0==t||1==t)i=t;else{var e=this.period/4;t-=1,i=-Math.pow(2,10*t)*Math.sin((t-e)*Math.PI/2/this.period)}this.inner.step(i)}}),e.EaseElasticOut=h.extend({init:function(t,i){a.call(this,t),this.period=void 0===i?.3:i},step:function(t){var i=0;if(0==t||1==t)i=t;else{var e=this.period/4;i=Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI/2/this.period)+1}this.inner.step(i)}}),e.EaseElasticInOut=h.extend({init:function(t,i){a.call(this,t),this.period=void 0===i?.3:i/1e3},step:function(t){var i=0;if(0==t||1==t)i=t;else{t*=2,this.period||(this.period=.3*1.5);var e=this.period/4;i=(t-=1)<0?-.5*Math.pow(2,10*t)*Math.sin((t-e)*Math.PI/2/this.period):Math.pow(2,-10*t)*Math.sin((t-e)*Math.PI/2/this.period)*.5+1}this.inner.step(i)}}),function(){function t(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}e.BounceEaseIn=h.extend({init:function(t){a.call(this,t),this.period="undefined"==typeof period?.3:period/1e3},step:function(i){this.inner.step(1-t(1-i))}}),e.BounceEaseOut=h.extend({step:function(i){this.inner.step(t(i))}}),e.BounceEaseInOut=h.extend({step:function(i){var e=0;e=i<.5?.5*(1-t(1-(i*=2))):.5*t(2*i-1)+.5,this.inner.step(e)}})}(),e.BackEaseIn=h.extend({step:function(t){this.inner.step(t*t*(2.70158*t-1.70158))}}),e.BackEaseOut=h.extend({step:function(t){t-=1,this.inner.step(t*t*(2.70158*t+1.70158)+1)}}),e.BackEaseInOut=h.extend({step:function(t){var i=0;i=(t*=2)<1?t*t*(3.5949095*t-2.5949095)/2:(t-=2)*t*(3.5949095*t+2.5949095)/2+1,this.inner.step(i)}}),e.MouseEvent=function(t,i,e,n){this.orign=t,this.type=n,this.x=i,this.y=e,this.swallowed=!1},e.MouseEvent.prototype.swallow=function(){this.swallowed=!0},e.KeyboardEvent=function(t,i,e,n){this.orign=t,this.type=n,this.keyCode=e,this.charCode=t.charCode,this.key=i,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.ctrlKey=t.ctrlKey,this.swallowed=!1},e.KeyboardEvent.prototype.swallow=function(){this.swallowed=!0},e.DebugFps=e.Node.extend({init:function(t){e.Node.prototype.init.call(this),this.anchor(0).size(180,28),this.font=new e.Sysfont("microsoft yahei",12,"#FFF"),this.director=t},draw:function(t){t.fillStyle="rgba(0, 0, 0)",t.fillRect(0,0,this.w,this.h);var i=this.director.debugData;this.font.beginDraw(t,"left","middle"),this.font.fillText(t,"udt: "+i.updateTime.toFixed(2),0,7),this.font.fillText(t,"fps: "+i.fps,70,7),this.font.fillText(t,"objs: "+i.objs,130,7),this.font.fillText(t,"dw: "+i.drawTime.toFixed(2),0,21),this.font.fillText(t,"dfps: "+i.drawFps,70,21),this.font.fillText(t,"dws: "+i.draws,130,21)}})}(window,window.le);