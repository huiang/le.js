if(Object.getPrototypeOf=Object.getPrototypeOf||function(a){return a.__proto__},Object.setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},Object.defineProperty||(Object.defineProperty=function(a,b,c){if(!a.__defineGetter__)throw new TypeError("Object.defineProperty not supported");c.get&&a.__defineGetter__(b,c.get),c.set&&a.__defineSetter__(b,c.set)}),"function"!=typeof Object.create&&(Object.create=function(a){var b=function(){};return b.prototype=a,new b}),!Function.prototype.bind){var Empty=function(){};Function.prototype.bind=function(a){var b=this;if("function"!=typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+b);var c=Array.prototype.slice.call(arguments,1),d=function(){if(this instanceof d){var e=b.apply(this,c.concat(Array.prototype.slice.call(arguments)));return Object(e)===e?e:this}return b.apply(a,c.concat(Array.prototype.slice.call(arguments)))};return b.prototype&&(Empty.prototype=b.prototype,d.prototype=new Empty,Empty.prototype=null),d}}!function(){function a(a,b,c){Object.keys(c).forEach(function(d){if(b[d]=c[d],"function"!=typeof c[d])throw new TypeError("extend: Method `"+d+"` is not a function");Object.defineProperty(a.prototype,d,{configurable:!0,value:c[d]})})}function b(a,b,c){return a.prototype[b].apply(this,c)}Object.defineProperty(Object.prototype,"extend",{value:function(){function c(){return this.init.apply(this,arguments),this}var d={},e=Array.prototype.slice.call(arguments,0);if(c.fn=c.prototype=Object.create(this.prototype),e.forEach(function(b){a(c,d,b.__methods__||b)}),!("init"in c.prototype))throw new TypeError("extend: Class is missing a constructor named `init`");return Object.defineProperty(c.prototype,"_super",{value:b}),Object.defineProperty(c,"__methods__",{value:d}),c}})}(),Math.rand=function(a,b){return Math.random()*(b-a)+a},Number.prototype.clamp=function(a,b){return this<a?a:this>b?b:+this},window.requestAnimationFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)}}(),window.cancelAnimationFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||function(a){window.clearTimeout(a)}}(),window.performance=window.performance||{},window.performance.now=function(){return window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now?Date.now.bind(Date):function(){return(new Date).getTime()}}(),Function.prototype.defer=function(){return setTimeout(this.bind.apply(this,arguments),.01)},window.le=function(){var a={directors:[],timer:null,loader:null,message:null};a._clock=0,a._ticker=0,this._error="";var b=this;a.NOSWALLOW=2,a.NOINSIDE=4,a.REPLACE=2,a.loadDirector=function(b,c){var d=new le.Director(b,c);return a.directors.push(d),d},a.removeDirector=function(b){for(var c in a.directors)if(a.directors==directors){var d=a.directors[c];d._exit(),a.directors.splice(c,1);break}},a.reportError=function(a){console.log(a),this._error=a};var c=[],d=[],e=!1;a.step={add:function(a){return e?d.push(a):c.push(a),this.run(),this},run:function(){if(e)return this;for(e=!0;c.length>0;){c.shift()(),c=d.concat(c),d=[]}e=!1}},this.update=function(b){a._clock+=b,a._ticker++,a.timer&&a.timer._update(b);for(var c in a.directors)a.directors[c].update(b);a.timer&&a.timer._updateAfterAll();for(var c in a.directors)a.directors[c].update(b)};var f=~~window.performance.now(),b=this;return b.loop=function(){var a=~~window.performance.now(),c=a-f;c>0&&(f=a,b.update(c)),window.requestAnimationFrame(b.loop)},b.loop(),a}(),function(a,b){!function(){function c(a,b){this.type=a,this.swallowed=!1,this.data=b}c.prototype.swallow=function(){this.swallowed=!0},b.Message=Object.extend({init:function(){this._list={}},listen:function(a,b,c,d){void 0==this._list[b]&&(this._list[b]={lns:[],dirty:0}),this._list[b].lns.push({fn:c,t:a,p:d||0}),this._list[b].dirty=1},unlisten:function(a,b,c){var d=this._list;if(void 0!==b){if(void 0!=d[b])for(var e=0,f=d[b].lns.length;e<f;e++)d[b].lns[e].t!=a||void 0!==c&&c!==d[b].lns[e].fn||(d[b].lns[e].fn=null,d[b].lns.splice(e,1),e--,f--)}else for(var b in d)for(var e=0,f=d[b].lns.length;e<f;e++)d[b].lns[e].t==a&&(d[b].lns[e].fn=null,d[b].lns.splice(e,1),e--,f--)},dispatch:function(a,b){if(void 0!=this._list[a]){var d=this._list[a],e=new c(a,b);d.dirty&&(d.lns.sort(function(a,b){return-(a.p-b.p)}),d.dirty=0);var f=d.lns.slice(0);for(var g in f)if(f[g].fn&&(f[g].fn(e,f[g].t),e.swallowed))break}}}),a._messageSingle=new b.Message,b.message=a._messageSingle}(),b.Director=Object.extend({init:function(a,c){this._error=null,this._clock=0;var d="string"==typeof a?document.getElementById(a):a;this.container=d;var e=d.clientWidth,f=d.clientHeight;this.containerSize={w:e,h:f},this.winSize={w:e,h:f},this.designResolution="SHOW_ALL",c.call(this,e,f),this.winScale={sx:this.containerSize.w/this.winSize.w,sy:this.containerSize.h/this.winSize.h};var g=document.createElement("canvas");g.style.position="absolute",g.style.left="0",g.style.zIndex="1000",g.style.top="0",g.style.width="100%",g.style.height="100%",g.width=this.winSize.w,g.height=this.winSize.h,d.appendChild(g),this.canvas=g,this._context=g.getContext("2d"),this._cacheCanvas=document.createElement("canvas"),this._cacheCanvas.width=this.winSize.w,this._cacheCanvas.height=this.winSize.h,this._cacheContext=this._cacheCanvas.getContext("2d"),this.world=new b.Layer(this),this.world._enter(this),this._scenes=[],this.debugData={objs:0,draws:0,drawTime:0,updateTime:0,fps:0,updateFps:0,drawFps:0,cfps:0,cfpsCountClock:0,cupdateFps:0,cdrawFps:0},this._isPause=!1,this.cursors=[],this._debugFps=null,this.showError=!1,this._clearBeforeDraw=!0,this._events={},this.initEvent()},setDesignResolutionSize:function(a,b,c){this.winSize={w:a,h:b},void 0!==c&&(this.designResolution=c)},_exit:function(){},getContext:function(){return this._context},update:function(b){var c=this.debugData;if(c.cfps++,null!=this.world&&0==this._isPause){var d=a.performance.now();c.cupdateFps++,c.objs=0,this.world.__update(b,this),c.updateTime=a.performance.now()-d,this.world.dirty&&(this._clearBeforeDraw&&(this._context.clearRect(0,0,this.winSize.w,this.winSize.h),this._cacheContext.clearRect(0,0,this.winSize.w,this.winSize.h)),d=a.performance.now(),c.cdrawFps++,c.draws=0,this.world.__draw(this._cacheContext,this,null),this._context.drawImage(this._cacheCanvas,0,0),c.drawTime=a.performance.now()-d)}c.cfpsCountClock+=b,c.cfpsCountClock>=1e3&&(c.updateFps=c.cupdateFps,c.drawFps=c.cdrawFps,c.fps=c.cfps,c.cfpsCountClock-=1e3,c.cfps=0,c.cupdateFps=0,c.cdrawFps=0),this._debugFps&&this._debugFps.__draw(this._context,null,null)},_updateAfterAll:function(){for(var a in this._events)for(var b in this._events[a].v)null==this._events[a].v[b]&&this._events[a].v.splice(b,1)},showFps:function(){this._debugFps=new b.DebugFps(this)},noClearBeforeDraw:function(){this._clearBeforeDraw=!1},initEvent:function(){var a=this,c=[{type:"mouseup",value:["mouseup"]},{type:"mousemove",value:["mousemove"]},{type:"mousedown",value:["mousedown"]},{type:"mousecancel",value:["mouseout"]}];b.device.touch&&(c=[{type:"mouseup",value:["touchend"]},{type:"mousemove",value:["touchmove"]},{type:"mousedown",value:["touchstart"]},{type:"mousecancel",value:["touchcancel"]}]),c.forEach(function(c){c.value.forEach(function(d){a.canvas.addEventListener(d,function(d){var e=a.canvas.getBoundingClientRect(),f=d.clientX,g=d.clientY;void 0!=d.touches&&(d.touches.length>0?(f=d.touches.item(0).clientX,g=d.touches.item(0).clientY):void 0!=d.changedTouches&&d.changedTouches.length>0?(f=d.changedTouches.item(0).clientX,g=d.changedTouches.item(0).clientY):console.log("error",d));var h=new b.MouseEvent(d,(f-e.left)/a.winScale.sx,(g-e.top)/a.winScale.sy,c.type);a.triggerEvent(c.type,h)})})}),["keyup","keypress","keydown"].forEach(function(c){document.addEventListener(c,function(d){var e=new b.KeyboardEvent(d,d.key,d.keyCode,c);a.triggerEvent(c,e)})})},triggerEvent:function(a,b){var c=this._events;if(void 0!==c[a]){c[a].dirty&&(c[a].v=this.sortWithGlobalZorder(c[a].v),c[a].dirty=0);for(var d in c[a].v)if(null!=c[a].v[d]&&c[a].v[d].trigger(a,b),b.swallowed)break}},sortWithGlobalZorder:function(a){var c=[];for(var d in a)null!=a[d]&&c.push({t:a[d],os:a[d].getParentsOrder()});c.sort(function(a,c){for(var d=a.os.length,e=c.os.length,f=0;f<d&&f<e;f++)if(a.os[f]!=c.os[f])return a.os[f]>c.os[f]?-1:1;return b.director.reportError("sortWithGlobalZorder error."),-(d-e)});var e=[];for(var f in c)e.push(c[f].t);return e},_register:function(a,b){var c=this._events;void 0===c[b]&&(c[b]={m:0,v:[],dirty:0}),c[b].v.push(a),c[b].dirty=1},_unregister:function(a,b){var c=this._events;for(var d in c)if(void 0===b||b==d)for(j in c[d].v)c[d].v[j]==a&&(c[d].v[j]=null)},currentScene:function(){return self._scenes>0?self._scenes[self._scenes.length-1]:null},startScene:function(a,c){c=void 0===c?0:c;var d=this;b.step.add(function(){if(d._scenes.length>0){var a=d._scenes[d._scenes.length-1];c&b.REPLACE&&d._scenes.pop(),a._doFinish()}}).add(function(){d._scenes.push(a),a._doStart(d,d.world)})},finishScene:function(a){var c=this;if(c._scenes.length>0){var d=c._scenes.indexOf(a);if(d<0)return!1;d==c._scenes.length-1?b.step.add(function(){c._scenes.pop(),a._doFinish()}).add(function(){if(c._scenes.length>0){c._scenes[c._scenes.length-1]._doStart(c,c.world)}}):c._scenes.splice(d,1)}},popSceneTo:function(a){if(!(a>=this._scenes.length)){var c=this;b.step.add(function(){if(this._scenes.length>0){c._scenes[c._scenes.length-1]._doFinish()}}).add(function(){for(;c._scenes.length>a-1;)c._scenes.pop();c._scenes[c._scenes.length-1]._doStart(c,c.world)})}}}),function(){var c=function(a){return a.substring(0,1).toUpperCase()+a.substring(1,a.length)};b.agent=function(){var b={},d=["ms","MS","moz","webkit","o"];return b.prefixed=function(b,e){if(e=e||a,b in e)return e[b];var f,g=c(b);return d.some(function(a){var b=a+g;return f=b in e?e[b]:void 0}),f},b.setPrefixed=function(b,e,f){if(f=f||a,b in f)return void(f[b]=e);var g=c(b);d.some(function(a){var b=a+g;return b in f&&(f[b]=e,!0)})},b}()}(),function(){b.device=function(){function c(a){a.reading?(e.accelerationX=a.reading.accelerationX,e.accelerationY=a.reading.accelerationY,e.accelerationZ=a.reading.accelerationZ):(e.accelerationX=a.accelerationIncludingGravity.x,e.accelerationY=a.accelerationIncludingGravity.y,e.accelerationZ=a.accelerationIncludingGravity.z)}function d(a){e.gamma=a.gamma,e.beta=a.beta,e.alpha=a.alpha}var e={},f=!1,g=!1,h=!0,i=function(b){return b.preventDefault(),a.scroll(0,0),!1};return e._check=function(){b.device._detectDevice(),b.device.isMobile&&!b.device.cocoon&&e.enableSwipe(!1),b.device.pointerEvent=b.agent.prefixed("PointerEvent",a),b.device.maxTouchPoints=b.agent.prefixed("maxTouchPoints",navigator)||0,a.gesture=b.agent.prefixed("gesture"),b.device.touch="createTouch"in document||"ontouchstart"in a||b.device.cocoon||b.device.pointerEvent&&b.device.maxTouchPoints>0,b.device.wheel="onwheel"in document.createElement("div"),b.device.hasAccelerometer=void 0!==a.DeviceMotionEvent||void 0!==a.Windows&&"function"==typeof Windows.Devices.Sensors.Accelerometer,this.hasPointerLockSupport=b.agent.prefixed("pointerLockElement",document),this.hasPointerLockSupport&&(document.exitPointerLock=b.agent.prefixed("exitPointerLock",document)),a.DeviceOrientationEvent&&(b.device.hasDeviceOrientation=!0),this.hasFullscreenSupport=b.agent.prefixed("fullscreenEnabled",document)||document.mozFullScreenEnabled,document.exitFullscreen=b.agent.prefixed("cancelFullScreen",document)||b.agent.prefixed("exitFullscreen",document),navigator.vibrate=b.agent.prefixed("vibrate",navigator);try{e.localStorage=!!a.localStorage}catch(a){e.localStorage=!1}a.addEventListener("blur",function(){},!1),a.addEventListener("focus",function(){},!1);var c,d;void 0!==document.hidden?(c="hidden",d="visibilitychange"):void 0!==document.mozHidden?(c="mozHidden",d="mozvisibilitychange"):void 0!==document.msHidden?(c="msHidden",d="msvisibilitychange"):void 0!==document.webkitHidden&&(c="webkitHidden",d="webkitvisibilitychange"),"string"==typeof d&&document.addEventListener(d,function(){document[c]},!1)},e._detectDevice=function(){b.device.iOS=/iPhone|iPad|iPod/i.test(b.device.ua),b.device.android=/Android/i.test(b.device.ua),b.device.android2=/Android 2/i.test(b.device.ua),b.device.chromeOS=/CrOS/.test(b.device.ua),b.device.wp=/Windows Phone/i.test(b.device.ua),b.device.BlackBerry=/BlackBerry/i.test(b.device.ua),b.device.Kindle=/Kindle|Silk.*Mobile Safari/i.test(b.device.ua),b.device.isMobile=/Mobi/i.test(b.device.ua)||b.device.iOS||b.device.android||b.device.wp||b.device.BlackBerry||b.device.Kindle||!1,b.device.ejecta=void 0!==a.ejecta,b.device.cocoon=navigator.isCocoonJS||void 0!==a.Cocoon},e.ua=navigator.userAgent,e.localStorage=!1,e.hasAccelerometer=!1,e.hasDeviceOrientation=!1,e.hasFullscreenSupport=!1,e.hasPointerLockSupport=!1,e.nativeBase64="function"==typeof a.atob,e.maxTouchPoints=0,e.touch=!1,e.wheel=!1,e.isMobile=!1,e.iOS=!1,e.android=!1,e.android2=!1,e.ejecta=!1,e.cocoon=!1,e.chromeOS=!1,e.wp=!1,e.BlackBerry=!1,e.Kindle=!1,e.orientation=0,e.accelerationX=0,e.accelerationY=0,e.accelerationZ=0,e.gamma=0,e.beta=0,e.alpha=0,e.language=navigator.language||navigator.browserLanguage||navigator.userLanguage||"en",e.enableSwipe=function(b){!1!==b?!1===h&&(a.document.removeEventListener("touchmove",i,!1),h=!0):!0===h&&(a.document.addEventListener("touchmove",i,!1),h=!1)},e.requestFullscreen=function(a){this.hasFullscreenSupport&&(a=a,a.requestFullscreen=b.agent.prefixed("requestFullscreen",a)||a.mozRequestFullScreen,a.requestFullscreen())},e.exitFullscreen=function(){this.hasFullscreenSupport&&document.exitFullscreen()},e.turnOffPointerLock=function(){this.hasPointerLockSupport&&document.exitPointerLock()},e.watchAccelerometer=function(){if(b.device.hasAccelerometer){if(!f){if("undefined"==typeof Windows)a.addEventListener("devicemotion",c,!1);else{var d=Windows.Devices.Sensors.Accelerometer.getDefault();if(d){var e=d.minimumReportInterval,g=e>=16?e:25;d.reportInterval=g,d.addEventListener("readingchanged",c,!1)}}f=!0}return!0}return!1},e.unwatchAccelerometer=function(){if(f){if("undefined"==typeof Windows)a.removeEventListener("devicemotion",c,!1);else{Windows.Device.Sensors.Accelerometer.getDefault().removeEventListener("readingchanged",c,!1)}f=!1}},e.watchDeviceOrientation=function(){return b.device.hasDeviceOrientation&&!g&&(a.addEventListener("deviceorientation",d,!1),g=!0),!1},e.unwatchDeviceOrientation=function(){g&&(a.removeEventListener("deviceorientation",d,!1),g=!1)},e.vibrate=function(a){navigator.vibrate&&navigator.vibrate(a)},e}()}(),b.Timer=function(){this._id=0,this._timers=[]},b.Timer.prototype._update=function(a){for(var b=this._timers,c=b.length-1;c>=0;c--)b[c].id<0&&b.splice(c,1);for(var c=0;c<b.length;c++)b[c].id<0||(-1==b[c].n?(b[c].n=0,b[c].c=0):(b[c].n+=a,b[c].c+=a),b[c].n>=b[c].iv&&(b[c].fn(b[c].n,b[c].c),b[c].t>=0&&b[c].c>=b[c].t&&(b[c].id=-1),b[c].n%=b[c].iv))},b.Timer.prototype.setTimeout=function(a,b){b=void 0===b?0:b,this._timers.push({iv:b,c:0,n:-1,t:b,fn:a,id:++this._id})},b.Timer.prototype.setInterval=function(a,b,c){b=void 0===b?-1:b,0!=(c=void 0===c?-1:c)&&this._timers.push({iv:b,c:0,n:-1,t:c<0?-1:c*(b>0?b:1e3/60),fn:a,id:++this._id})},b.Timer.prototype.clearTimer=function(a){for(var b=0,c=this._timers.length;b<c;b++)if(this._timers[b].id==a){this._timers[b].id=-1;break}},function(){b.timer=new b.Timer;var a=[];b.timer.callAfterAll=function(b){a.push(b)},b.timer._updateAfterAll=function(){for(var b=0,c=a.length;b<c;b++)a[b](0,0);a=[]},b.timer.now=function(){return b._clock},b.timer.ticker=function(){return b._ticker}}(),function(){b.loader=function(){function b(a){if(m===l)if(a||g.onload){clearTimeout(n);var c=a||g.onload;setTimeout(function(){c()},300)}else console.error("no load callback defined");else n=setTimeout(function(){b(a)},100)}function c(a,b,c){h[a.name]=new Image,h[a.name].onload=b,h[a.name].onerror=c,"string"==typeof g.crossOrigin&&(h[a.name].crossOrigin=g.crossOrigin),h[a.name].src=a.src+g.nocache}function d(b,c,d){function e(a){i[b.name]=a,"tmx"===b.type&&me.levelDirector.addTMXLevel(b.name)}if(b.data)return e(b.data),void c();var f=new XMLHttpRequest,h=me.utils.getFileExtension(b.src);f.overrideMimeType&&("json"===h?f.overrideMimeType("application/json"):f.overrideMimeType("text/xml")),f.open("GET",b.src+g.nocache,!0),f.ontimeout=d,f.onreadystatechange=function(){if(4===f.readyState)if(200===f.status||0===f.status&&f.responseText){var b=null;switch(h){case"xml":case"tmx":case"tsx":if(me.device.ua.match(/msie/i)||!f.responseXML){if(!a.DOMParser)throw new Error("XML file format loading not supported, use the JSON file format instead");b=(new DOMParser).parseFromString(f.responseText,"text/xml")}else b=f.responseXML;var g=me.TMXUtils.parse(b);switch(h){case"tmx":b=g.map;break;case"tsx":b=g.tilesets[0]}break;case"json":b=JSON.parse(f.responseText);break;default:throw new Error("TMX file format "+h+"not supported !")}e(b),c()}else d()},f.send(null)}function e(a,b,c){var d=new XMLHttpRequest;d.overrideMimeType&&d.overrideMimeType("application/json"),d.open("GET",a.src+g.nocache,!0),d.ontimeout=c,d.onreadystatechange=function(){4===d.readyState&&(200===d.status||0===d.status&&d.responseText?(k[a.name]=JSON.parse(d.responseText),b()):c())},d.send(null)}function f(a,b,c){var d=new XMLHttpRequest;d.open("GET",a.src+g.nocache,!0),d.responseType="arraybuffer",d.onerror=c,d.onload=function(){var c=d.response;if(c){for(var e=new Uint8Array(c),f=[],g=0;g<e.byteLength;g++)f[g]=String.fromCharCode(e[g]);j[a.name]=f.join(""),b()}},d.send()}var g={},h={},i={},j={},k={},l=0,m=0,n=0;return g.nocache="",g.onload=void 0,g.onProgress=void 0,g.crossOrigin=void 0,g.onLoadingError=function(a){throw new Error("Failed loading resource "+a.src)},g.setNocache=function(a){g.nocache=a?"?"+~~(1e7*Math.random()):""},g.preload=function(a,c){for(var d=0;d<a.length;d++)l+=g.load(a[d],g.onResourceLoaded.bind(g,a[d]),g.onLoadingError.bind(g,a[d]));void 0!==c&&(g.onload=c),b(c)},g.load=function(a,b,g){switch(a.type){case"binary":return f.call(this,a,b,g),1;case"image":return c.call(this,a,b,g),1;case"json":return e.call(this,a,b,g),1;case"tmx":case"tsx":return d.call(this,a,b,g),1;default:throw new Error("load : unknown or invalid resource type : "+a.type)}},g.unload=function(a){switch(a.type){case"binary":return a.name in j&&(delete j[a.name],!0);case"image":return a.name in h&&("function"==typeof h[a.name].dispose&&h[a.name].dispose(),delete h[a.name],!0);case"json":return a.name in k&&(delete k[a.name],!0);case"tmx":case"tsx":return a.name in i&&(delete i[a.name],!0);default:throw new Error("unload : unknown or invalid resource type : "+a.type)}},g.unloadAll=function(){var a;for(a in j)j.hasOwnProperty(a)&&g.unload({name:a,type:"binary"});for(a in h)h.hasOwnProperty(a)&&g.unload({name:a,type:"image"});for(a in i)i.hasOwnProperty(a)&&g.unload({name:a,type:"tmx"});for(a in k)k.hasOwnProperty(a)&&g.unload({name:a,type:"json"})},g.getTMX=function(a){return a=""+a,a in i?i[a]:null},g.getBinary=function(a){return a=""+a,a in j?j[a]:null},g.getImage=function(a){return a=""+a,a in h?h[a]:null},g.getJSON=function(a){return a=""+a,a in k?k[a]:null},g.getLoadProgress=function(){return m/l},g}()}(),a.le.SpriteFrame=Object.extend({init:function(a,b){this.image=a,this.frame=b.frame,this.rotated=b.rotated,this.spriteSourceSize=b.spriteSourceSize,this.sourceSize=b.sourceSize}}),function(){b.spriteFrameCache=function(){var a={},c={};return a.add=function(a,d){for(var e in d.frames)c[e]=new b.SpriteFrame(a,d.frames[e])},a.get=function(a){return a in c?c[a]:null},a}()}(),b.Sysfont=Object.extend({init:function(a,b,c){this.fontWeight="",this.fontStyle="",this.fontSize=b,this.fontFamily=a,this.color=c,this._font=[this.fontWeight,this.fontStyle,this.fontSize+"px",this.fontFamily].join(" ")},attr:function(a){for(i in a)this[i]=a[i];return this._font=[this.fontWeight,this.fontStyle,this.fontSize+"px",this.fontFamily].join(" "),this},clone:function(a){return(new b.SysFont).attr({fontWeight:this.fontWeight,fontStyle:this.fontStyle,fontSize:this.fontSize,fontFamily:this.fontFamily,color:this.color})},beginMeasure:function(a){a.font=this._font},measure:function(a,b){return a.measureText(b).width},beginDraw:function(a,b,c){a.font=this._font,a.fillStyle=this.color,a.textAlign=b,a.textBaseline=c},fillText:function(a,b,c,d){a.fillText(b,c,d)}}),b.BitmapFont=Object.extend({init:function(a,b){this.fontSize=b,this.fontFamily=a,this._space=0},attr:function(a){for(i in a)this[i]=a[i];return this},setSpace:function(a){this._space=a},clone:function(a){return(new b.BitmapFont).attr({fontSize:this.fontSize,fontFamily:this.fontFamily})},beginMeasure:function(a){},measure:function(a,c){for(var d=0,e=0,f=c.length;e<f;e++){var g=c.charCodeAt(e),h=g.toString(16);g<=255?h="00"+h:g<=4095&&(h="0"+h),h=this.fontFamily+"_"+h+".png";var i=b.spriteFrameCache.get(h);null!=i&&(d+=i.sourceSize.w+this._space)}return d>0&&(d-=this._space),d},beginDraw:function(a,b,c){},fillText:function(a,c,d,e){for(var f=0,g=-this.fontSize/2,h=0,i=c.length;h<i;h++){var j=c.charCodeAt(h),k=j.toString(16);j<=255?k="00"+k:j<=4095&&(k="0"+k),k=this.fontFamily+"_"+k+".png";var l=b.spriteFrameCache.get(k);null!=l&&(a.drawImage(l.image,l.frame.x,l.frame.y,l.frame.w,l.frame.h,f+d+l.spriteSourceSize.x,g+e+l.spriteSourceSize.y,l.spriteSourceSize.w,l.spriteSourceSize.h),f+=l.sourceSize.w+this._space)}}}),b.Node=Object.extend({init:function(){this.x=0,this.y=0,this.w=0,this.h=0,this.anchorX=0,this.anchorY=0,this.opacity=1,this.rotation=0,this.scaleX=1,this.scaleY=1,this._zIndex=0,this.visible=!0,this.dirty=3,this.name=null,this.parent=null,this._director=null,this.children=[],this._cacheContent=0,this._actions=null,this._timer=null,this._msgs=null,this._events=null,this._showBorder=!1},pos:function(a,b){return this.x=a,this.y=b,this.dirty|=1,this},posX:function(a){return this.x=a,this.dirty|=1,this},posY:function(a){return this.y=a,this.dirty|=1,this},scale:function(a,b){return this.scaleX=a,this.scaleY=void 0===b?a:b,this.dirty|=1,this},anchor:function(a,b){return this.anchorX=a,this.anchorY=void 0===b?a:b,this.dirty|=1,this},size:function(a,b){return this.w=a,this.h=b,this.dirty|=2,this},showBorder:function(){return this._showBorder=!0,this.dirty|=1,this},setRotation:function(a){return this.rotation=a,this.dirty|=1,this},setOpacity:function(a){return this.opacity=a,this.dirty|=2,this},setZIndex:function(a){return this._zIndex=a,this.dirty|=1,this},setVisible:function(a){return this.visible=a,this.dirty|=1,this},setName:function(a){return this.name=a,this},contentDirty:function(){return this.dirty|=2,this},outerDirty:function(){return this.dirty|=1,this},_clearDirty:function(){this.dirty=0;for(var a=0;a<this.children.length;a++)b.Node.prototype._clearDirty.call(this.children[a])},getAttr:function(a){if("string"==typeof a)return a;for(var b={},c=0,d=a.length;c<d;c++)b[a[c]]=this[a[c]];return b},cacheContent:function(a,b){return this._cacheContent|=b?3:1,this.__cacheMargin=a||0,0==this.__cacheMargin&&(this._cacheContent|=4),this.dirty|=2,this},clip:function(a){return this._cacheContent|=8,a&&(this._cacheContent|=16),this.dirty|=2,this},enableClipInherit:function(){return this._cacheContent|=32,this.dirty|=2,this},appendTo:function(a){return a.addChild(this),this},addChild:function(){for(var a=0;a<arguments.length;a++){for(var b=!1,c=this.children.length-1;c>=0;c--)if(this.children[c]._zIndex<=arguments[a]._zIndex){this.children.splice(c+1,0,arguments[a]),b=!0;break}if(0==b&&this.children.unshift(arguments[a]),null!==arguments[a].parent)throw new Error("add failed since parent is not null.");arguments[a].parent=this,this.isRunning()&&arguments[a]._enter(this._director),null!=this._upnodes&&this._upnodes.push(arguments[a])}return this.dirty|=2,this},removeAllChildren:function(){for(var a=this.children.length-1;a>=0;a--)this.isRunning()&&this.children[a]._exit(),this.children[a].parent=null;return this.children=[],this.dirty|=2,this},removeChild:function(a){if("string"==typeof a){for(var b=0;b<this.children.length;b++)if(this.children[b].name==a){var c=this.children[b];this.children.splice(b,1),this.isRunning()&&c._exit(),c.parent=null;break}}else for(var b=0;b<this.children.length;b++)if(this.children[b]==a){this.children.splice(b,1),this.isRunning()&&a._exit(),a.parent=null;break}return this.dirty|=2,this},removeFromParent:function(){this.parent&&this.parent.removeChild(this)},isRunning:function(){return null!=this._director},_enter:function(a){if(this._director=a,null!=this._events)for(var c in this._events)a._register(this,c);if(null!=this._msgs)for(var d in this._msgs)for(var e in this._msgs[d])null!=this._msgs[d][e].fn&&b.message.listen(this,d,this._msgs[d][e].fn,this._msgs[d][e].p);for(var f=this.children.slice(0),c=0,g=f.length;c<g;c++)f[c]._enter(a)},_exit:function(){for(var a=this.children.slice(0),c=0,d=a.length;c<d;c++)a[c]._exit();if(null!=this._msgs)for(var e in this._msgs)b.message.unlisten(this,e);if(null!=this._events)for(var c in this._events)this._director._unregister(this,c);this._director=null},__update:function(a,c){if(c&&c.debugData.objs++,null!=this._timer&&this._timer._update(a),null!=this._actions)for(var d=this._actions,e=0;e<d.length;e++)null!=d[e]?(d[e].update(a),d[e].isDone()&&(d[e].stop(),d.splice(e,1),e--)):(d.splice(e,1),e--);this._upnodes=this.children.slice(0);for(var e=0;e<this._upnodes.length;e++)this._upnodes[e].parent==this&&(b.Node.prototype.__update.call(this._upnodes[e],a,c),this._upnodes[e].dirty&&(this.dirty|=2))},draw:function(a){},__draw:function(a,c,d){if(0==this.visible)return void this._clearDirty();if(c&&c.debugData.draws++,1!=this.scaleX||1!=this.scaleY||0!=this.rotation)a.save(),a.translate(this.x,this.y),1==this.scaleX&&1==this.scaleY||a.scale(this.scaleX,this.scaleY),0!=this.rotation&&a.rotate(this.rotation*Math.PI/180),a.translate(-this.anchorX*this.w,-this.anchorY*this.h),d=null;else{if(null!==d&&(this.x-this.anchorX*this.w>d.right||this.y-this.anchorY*this.h>d.bottom||this.x+this.anchorX*this.w<d.left||this.y+this.anchorY*this.h<d.top))return void this._clearDirty();a.save(),a.translate(this.x-this.anchorX*this.w,this.y-this.anchorY*this.h)}if(1!=this.opacity&&(a.globalAlpha*=this.opacity),16&this._cacheContent)d={left:0,top:0,right:this.w,bottom:this.h};else if(null!=d&&32&this._cacheContent){var e=this.x-this.anchorX*this.w,f=this.y-this.anchorY*this.h;d.left-=e,d.top-=f,d.bottom-=f,d.right-=e}else d=null;if((2&this.dirty)>0&&1&this._cacheContent&&this.w>0&&this.h>0){var g=this.__cacheMargin;void 0===this.__cacheCanvas&&(this.__cacheCanvas=this.__createCanvas(this.w+2*g,this.h+=2*g),this.dirty|=2);var h=this.__cacheCanvas,i=this.w+2*g,j=this.h+2*g;h.width!=i||h.height!=j?(h.width=i,h.height=j):(2&this._cacheContent)>0&&h.getContext("2d").clearRect(0,0,h.width,h.height);var k=h.getContext("2d");g>0&&k.translate(g,g);for(var l=0,m=this.children.length;l<m;l++)this.children[l]._zIndex>=0||b.Node.prototype.__draw.call(this.children[l],k,c,d);this.draw(k),this._showBorder&&(k.save(),k.strokeStyle="#f00",k.lineWidth=1,k.strokeRect(0,0,this.w,this.h),k.restore());for(var l=0,m=this.children.length;l<m;l++)this.children[l]._zIndex<0||b.Node.prototype.__draw.call(this.children[l],k,c,d)}if(1&this._cacheContent&&this.w>0&&this.h>0)8==(12&this._cacheContent)&&(a.beginPath(),a.moveTo(0,0),a.lineTo(0,this.h),a.lineTo(this.w,this.h),a.lineTo(this.w,0),a.clip()),a.drawImage(this.__cacheCanvas,-this.__cacheMargin,-this.__cacheMargin);else{for(var l=0,m=this.children.length;l<m;l++)this.children[l]._zIndex>=0||b.Node.prototype.__draw.call(this.children[l],a,c,d);8==(8&this._cacheContent)&&(a.beginPath(),a.moveTo(0,0),a.lineTo(0,this.h),a.lineTo(this.w,this.h),a.lineTo(this.w,0),a.clip()),this.draw(a),this._showBorder&&(a.save(),a.strokeStyle="#f00",a.lineWidth=1,a.strokeRect(0,0,this.w,this.h),a.restore());for(var l=0,m=this.children.length;l<m;l++)this.children[l]._zIndex<0||b.Node.prototype.__draw.call(this.children[l],a,c,d)}a.restore(),this.dirty=0},__createCanvas:function(a,b){var c=document.createElement("canvas");return c.width=a,c.width=b,c},setInterval:function(a,c,d){return null==this._timer&&(this._timer=new b.Timer),this._timer.setInterval(a,c,d)},setTimeout:function(a,c){return null==this._timer&&(this._timer=new b.Timer),this._timer.setTimeout(a,c)},clearTimer:function(a){return null!=this._timer&&this._timer.clearTimer(a),this},getParentsOrder:function(){for(var a=[],b=this;null!=b.parent;){var c=b.parent.children.indexOf(b)+1;a.unshift(b._zIndex>=0?c:-1e8+c),b=b.parent}return a.push(0),a},convertToLocal:function(a){var b=[],c=this,d={x:a.x,y:a.y};for(b.unshift(c);null!=c.parent;)b.unshift(c.parent),c=c.parent;for(var e in b)d.x=d.x-b[e].x,d.y=d.y-b[e].y,1!=b[e].scaleX&&(d.x=0!=b[e].scaleX?d.x/Math.abs(b[e].scaleX):1e9),1!=b[e].scaleY&&(d.y=0!=b[e].scaleY?d.y/Math.abs(b[e].scaleY):1e9),d.x+=b[e].anchorX*b[e].w,d.y+=b[e].anchorY*b[e].h;return d},getWorldBound:function(a){a=void 0===a?{x:0,y:0,w:this.w,h:this.h}:a;var b={x:this.x-(this.anchorX*a.w-a.x)*Math.abs(this.scaleX),y:this.y-(this.anchorY*a.h-a.y)*Math.abs(this.scaleY),w:a.w*Math.abs(this.scaleX),h:a.h*Math.abs(this.scaleY)};return this.parent?this.parent.getWorldBound(b):b},bind:function(a,b,c){null==this._events&&(this._events={}),a=a.split(" ");for(var d in a)"click"==a[d]&&this._initClickEvent(),void 0===this._events[a[d]]&&(this._events[a[d]]=[]),this._events[a[d]].push({fn:b,m:void 0===c?0:c,p:0}),this.isRunning()&&this._director._register(this,a[d]);return this},unbind:function(a,b){a=a.split(" ");for(var c in a)if(void 0!==this._events[a[c]])for(var d in this._events[a[c]])this._events[a[c]][d].fn===b&&(this._events[a[c]][d].fn=null);return this},unbindAll:function(a){},trigger:function(a,c){var d=this._events[a];if(d)for(var e=0,f=d.length;e<f;e++)if(null!=d[e].fn){if(0==a.indexOf("mouse")&&0==(d[e].m&b.NOINSIDE)){if(0==this.visible)continue;var g=this.getWorldBound();if(c.x<g.x||c.y<g.y||c.x>g.x+g.w||c.y>g.y+g.h)continue}d[e].fn(c)}else d.splice(e,1),e--,f--},_initClickEvent:function(){if(!("_isInitedClickEvent"in this&&this._isInitedClickEvent)){this._isInitedClickEvent=!0;var a=this,c=!1,d=!1,e=0,f=0;this.bind("mousedown",function(a){c=!0,d=!0,e=a.x,f=a.y}),this.bind("mousemove",function(a){c&&(d&&(Math.abs(e-a.x)>20&&(d=!1),Math.abs(f-a.y)>20&&(d=!1)),a.swallow())},b.NOINSIDE),this.bind("mouseup mousecancel",function(g){c&&(g.swallow(),d&&"mouseup"==g.type&&a.trigger("click",new b.MouseEvent(g,g.x,g.y,"click")),c=!1,d=!1,e=0,f=0)},b.NOINSIDE)}},listen:function(a,c,d){null==this._msgs&&(this._msgs={}),types=a.split(" ");for(var e in types)void 0===this._msgs[types[e]]&&(this._msgs[types[e]]=[]),this._msgs[types[e]].push({fn:c,p:d||0}),this.isRunning()&&b.message.listen(this,types[e],c,d);return this},unlisten:function(a,c){if(void 0!==this._msgs[a])if(void 0===c)b.message.unlisten(this,a);else for(var d in this._msgs[a])this._msgs[a][d].fn===c&&(this._msgs[a][d].fn=null,this.isRunning()&&b.message.unlisten(this,a,c));return this},unlistenAll:function(){b.message.unlisten(this),this._msgs=[]},runAction:function(a){null==this._actions&&(this._actions=[]),this._actions.push(a),a.start(this)},stopAction:function(a){if(null!=this._actions)for(var b=0,c=this._actions.length;b<c;b++)this._actions[b]==a&&(this._actions[b].stop(),this._actions[b]=null)},stopAllAction:function(a){for(var b=0,c=this._actions.length;b<c;b++)this._actions[b].stop(),this._actions[b]=null}}),b.Layer=b.Node.extend({init:function(a){b.Node.prototype.init.call(this),this.w=a.winSize.w,this.h=a.winSize.h}}),b.LayerColor=b.Node.extend({init:function(a,c){b.Node.prototype.init.call(this),this.w=c.winSize.w,this.h=c.winSize.h,this.color=a},draw:function(a){a.fillStyle=this.color,
a.fillRect(0,0,this.w,this.h)}}),b.Sprite=b.Node.extend({init:function(a){b.Node.prototype.init.call(this),this.frame=b.spriteFrameCache.get(a),null!=this.frame&&(this.w=this.frame.sourceSize.w,this.h=this.frame.sourceSize.h),this.anchorX=.5,this.anchorY=.5},draw:function(a){var b=this.frame;null!=b&&a.drawImage(b.image,b.frame.x,b.frame.y,b.frame.w,b.frame.h,b.spriteSourceSize.x,b.spriteSourceSize.y,b.spriteSourceSize.w,b.spriteSourceSize.h)}}),b.Label=b.Node.extend({init:function(a,c){b.Node.prototype.init.call(this),this.text=a,this.font=c,this.lineHeight=-1,this.textAlign="left",this.anchorX=.5,this.anchorY=.5,this._dw=0,this._dh=0,this._lines=[],this._measure()},_measure:function(){var a=this.lineHeight>0?this.lineHeight:this.font.fontSize,c=this.font.fontSize,d=b.Label._measureContext;d.save(),this.font.beginMeasure(d);var e=(""+this.text).split("\n");this._lines=[];var f=0;for(var g in e)if(this._dw>0&&e[g].length*c>this._dw)for(var h=e[g];h.length>0;){var i=this._divstr(d,h,this._dw,c,.6*c);this._lines.push(i.s1),h=i.s2,i.w>f&&(f=i.w)}else{this._lines.push(e[g]);var j=this.font.measure(d,e[g]);j>f&&(f=j)}d.restore(),this.w=f,this.h=a*this._lines.length,this._dh>0&&(this.h=this._dh),this._dw>0&&(this.w=this._dw)},_divstr:function(a,b,c,d,e){for(var f=c-e,g=0,h=b.length,i=0,j=0,k=0,l=b.charCodeAt(g)>127?d:e;g+1<h;g++)if(b.charCodeAt(g+1)>127){if(l+d>=c)break;l+=d}else{if(l+e>=c)break;l+=e}for(;;){if(++j>=20)break;if(i=b.substr(0,g+1),l=this.font.measure(a,i),-1==k&&l<=c)break;if(l>=f&&l<=c)break;if(l<f){if(g>=h-1)break;if(j>=3){g++;continue}do{g++,l+=b.charCodeAt(g)>127?d:e}while(g<h&&l<=f)}else{if(g<=1)break;if(j>=3)g--,k=-1;else do{g--,l-=b.charCodeAt(g)>127?d:e}while(g>0&&l>c)}}return{w:l,pos:g,s1:i,s2:b.substr(g+1)}},setTextAlign:function(a){return this.textAlign=a,this.dirty|=2,this},setText:function(a){return this.text=a,this.dirty|=2,this._measure(),this},setFont:function(a){return this.font=a,this.dirty|=2,this._measure(),this},setLineHeight:function(a){return this.lineHeight=a,this.dirty|=2,this._measure(),this},setDimension:function(a,b){return this._dw=a,this._dh=b,this.dirty|=2,this._measure(),this},draw:function(a){var b="left"==this.textAlign?0:"right"==this.textAlign?this.w:this.w/2,c=this.lineHeight>0?this.lineHeight:this.font.fontSize,d=c/2;this.font.beginDraw(a,this.textAlign,"middle");for(var e=0;e<this._lines.length;e++)this.font.fillText(a,this._lines[e],b,d),d+=c}}),b.Label._measureCanvas=document.createElement("canvas"),b.Label._measureContext=b.Label._measureCanvas.getContext("2d"),b.Button=b.Node.extend({init:function(a,c,d){b.Node.prototype.init.call(this),this.anchorX=.5,this.anchorY=.5,this.enable=!0;var e=null,f=null,g=null;e="string"==typeof a?new b.Sprite(a):a instanceof b.Node?a:new b.Node,"string"==typeof c?f=new b.Sprite(c):c instanceof b.Node&&(f=c),"string"==typeof d?g=new b.Sprite(d):d instanceof b.Node&&(g=d),this.w=e.w,this.h=e.h,e.anchorX=.5,e.anchorY=.5,e.x=this.w/2,e.y=this.h/2,this.addChild(e),null!=f&&(f.anchorX=.5,f.anchorY=.5,f.x=this.w/2,f.y=this.h/2,f.setVisible(!1),this.addChild(f)),null!=g&&(g.anchorX=.5,g.anchorY=.5,g.x=this.w/2,g.y=this.h/2,g.setVisible(!1),this.addChild(g)),this.normal=e,this.pressed=f,this.disabled=g,this._initClickEvent()},setEnable:function(a){return this.enable=a,this.dirty|=1,this},size:function(a,b){return this.w=a,this.h=b,this.normal.x=this.w/2,this.normal.y=this.h/2,null!=this.pressed&&(this.pressed.x=this.w/2,this.pressed.y=this.h/2),null!=this.disabled&&(this.disabled.x=this.w/2,this.disabled.y=this.h/2),this.dirty|=2,this},_initClickEvent:function(){if(!("_isInitedClickEvent"in this&&this._isInitedClickEvent)){this._isInitedClickEvent=!0;var a=this,c=!1,d=!1,e=0,f=0;this.bind("mousedown",function(b){c=!0,d=!0,e=b.x,f=b.y,a.enable&&a.pressed&&(a.pressed.setVisible(!0),a.normal&&a.normal.setVisible(!1))}),this.bind("mousemove",function(a){c&&(d&&(Math.abs(e-a.x)>20&&(d=!1),Math.abs(f-a.y)>20&&(d=!1)),a.swallow())},b.NOINSIDE),this.bind("mouseup mousecancel",function(g){c&&(g.swallow(),a.enable&&a.pressed&&(a.pressed.setVisible(!1),a.normal&&a.normal.setVisible(!0)),a.enable&&d&&"mouseup"==g.type&&a.trigger("click",new b.MouseEvent(g,g.x,g.y,"click")),c=!1,d=!1,e=0,f=0)},b.NOINSIDE)}}}),function(){var a=b.Node.extend({init:function(a){b.Node.prototype.init.call(this),this.show=!1,this.hide=!1,this.font=a,this.w=1,this.h=this.font.fontSize,this.clock=0;var c=this;this.setInterval(function(a,b){if(0!=c.show){c.clock+=a;var d=c.clock%1200>600;c.hide!=d&&(c.dirty|=2,c.hide=d)}})},startShow:function(){return this.show=!0,this.dirty|=1,console.log("startShow"),this},stopShow:function(){return this.show=!1,this.dirty|=1,console.log("stopShow"),this},draw:function(a){0==this.show||this.hide||(a.fillStyle=this.font.color,a.fillRect(0,0,this.w,this.h))}});b.Input=b.Node.extend({init:function(c){b.Node.prototype.init.call(this),this.label=new b.Label("",c),this.label.anchor(0,.5).pos(0,this.h/2).appendTo(this),this.cursor=new a(c),this.cursor.anchor(.5,.5).pos(0,this.h/2).appendTo(this),this.placeLabel=null,this.__input=null;var d=this;this.setInterval(function(a){d.update(a)}),this.bind("click",function(){d.focus()}),this.bind("mousedown",function(a){d.blur()},b.NOINSIDE),this._lastX=0,this._lastY=0,this._lastW=0,this._lastH=0},_enter:function(a){b.Node.prototype._enter.call(this,a),this.__initHtml()},_exit:function(){this._director.container.removeChild(this.__input),this.__input=null,b.Node.prototype._exit.call(this)},__initHtml:function(){var a=document.createElement("input");a.style.position="absolute",a.style.width=10,a.style.fontSize=this.label.font.fontSize+"px";var b=this;a.addEventListener("blur",function(){b.cursor.stopShow()}),a.addEventListener("focus",function(){b.cursor.startShow()}),this._director.container.appendChild(a),this.__input=a},__setHtmlPos:function(a,b,c){this.__input.style.left=a,this.__input.style.top=b},update:function(a){if(null!=this.__input&&(this.label.text!=this.__input.value&&(this.label.setText(this.__input.value),this.cursor.posX(this.label.w),this.label.w>this.w&&this.size(this.label.w,this.h)),this._lastH!=this.h&&(this.label.posY(this.h/2),this.cursor.posY(this.h/2)),this._lastW!=this.w||this._lastH!=this.h||this._lastX!=this.x||this._lastY!=this.y)){var b=this.h/2+this.label.h/2,c=this.getWorldBound({x:0,y:b,w:this.w,h:this.h-b}),d=this._director.winScale;this.__setHtmlPos(c.x*d.sx,c.y*d.sy,c.w*d.sx),this._lastW=this.w,this._lastX=this.x,this._lastY=this.y,this._lastH=this.h}},setPlaceholder:function(a,c){this.placeLabel&&this.removeChild(this.placeLabel),this.placeLabel=new b.Label(a,c),this.dirty|=2},setText:function(a){this.label.setText(a)},focus:function(){this.__input.focus(),this.__input.value=this.label.text,this.cursor.startShow()},blur:function(){this.__input.blur(),this.cursor.stopShow()}})}(),b.Video=b.Node.extend({init:function(a){b.Node.prototype.init.call(this),this.source=a,this.__video=null;var c=this;this.setInterval(function(a){c.update(a)},1/30)},__initHtml:function(){var a=document.createElement("video");a.src=this.source,a.style.position="absolute",a.style.width=320,a.style.height=100,a.style.left="100px",a.style.top="100px";this._director.container.appendChild(a),this.__video=a},_enter:function(a){b.Node.prototype._enter.call(this,a),this.__initHtml()},_exit:function(){this._director.container.removeChild(this.__video),this.__video=null,b.Node.prototype._exit.call(this)},play:function(){null!=this.__video&&this.__video.play()},pause:function(){null!=this.__video&&this.__video.pause()},update:function(a){this.dirty|=2},draw:function(a){this.__video&&a.drawImage(this.__video,0,0,this.w,this.h)}}),b.Scene=Object.extend({init:function(){this._indent={},this._data={},this.root=null,this._status="INITED",this._from="PUSH_IN",this._todoTasks=0,this.director=null},setIntent:function(a,b){this._indent[a]=b},getIntent:function(a){return this._indent[a]},etData:function(a,b){this._data[a]=b},getData:function(a){return this._data[a]},_doStart:function(a,c){this.director=a,null!=this.root&&this.root.removeFromParent(),this.root=new b.Layer(this.director),this.root.bind("mouseup mousedown mousemove mousecancel",function(a){a.swallow()}),c.addChild(this.root),this._status="LOADING",this.incTask();var d=this;b.step.add(function(){d.willLoad()}).add(function(){d.decTask()})},_doFinish:function(){if("FINISHED"!=this._status&&"FINISHING"!=this._status){this._status="FINISHING";var a=this;b.step.add(function(){"FINISHING"==a._status&&a.willExit()}).add(function(){"FINISHING"==a._status&&(null!=a.root&&(a.root.removeFromParent(),a.root=null),this._status="FINISHED",a.didExit())})}},incTask:function(){this._todoTasks++},decTask:function(){for(this._todoTasks--;this._todoTasks<=0&&"LOADING"==this._status;){var a=this;this._status="LOADED",b.step.add(function(){"LOADED"==a._status&&a.didLoad()}).add(function(){"LOADED"==a._status&&(a.willEnter(),a._status="RUNNING")}).add(function(){"RUNNING"==a._status&&a.didEnter()})}},finish:function(){null!=this.director?this.director.finishScene(this):b.director.reportError("finish with no start")},finishWithResult:function(){},willLoad:function(){},didLoad:function(){},willEnter:function(){},didEnter:function(){},willExit:function(){},didExit:function(){}}),b.Action=Object.extend({init:function(){},isRunning:function(){return!1}}),b.ActionInterval=b.Action.extend({init:function(a){this.duration=a,this.clock=0,this.target=null,this.fc=!0},getDuration:function(){return this.duration},start:function(a){this.target=a,this.clock=0,this.fc=!0},isDone:function(){return this.clock>=this.duration},stop:function(){this.target=null},isRunning:function(){return null!=this.target},update:function(a){if(null!=this.target)if(this.fc?(this.fc=!1,this.clock=0):this.clock+=a,this.duration>0){var b=this.clock/this.duration;b>1?b=1:b<0&&(b=0),this.step(b)}else this.step(this.clock>0?1:0)},step:function(a){}});var c=b.ActionInterval,d=c.prototype.init,e=c.prototype.start;b.ActionEasy=c.extend({init:function(a){d.call(this,a.duration),this.inner=a},start:function(a){e.call(this,a),this.inner.start(this.target)},stop:function(){c.prototype.stop.call(this),this.inner.stop()},step:function(a){this.inner.step(a)}}),b.Seq=c.extend({init:function(a){for(var b=a instanceof Array?a:Array.prototype.slice.call(arguments,0),c=0,e=0,f=b.length;e<f;e++)c+=b[e].duration;d.call(this,c),this._actions=b,this._last=-1,this.ld=0,this.fc=!0},start:function(a){e.call(this,a),this._last=-1,this.ld=0,this.fc=!0},stop:function(){-1!=this._last&&this._actions[this._last].stop(),c.prototype.stop.call(this)},update:function(a){var b=this._actions,c=this._last;if(this.fc){if(this.fc=!1,this.clock=0,this.ld=0,!(b.length>0))return;b[0].start(this.target),b[0].update(0),c=0}else this.clock+=a,this.ld+=a,-1!=c&&b[c].update(a);for(;-1!=c&&0!=b[c].isDone();){if(b[c].stop(),c+1>=b.length){c=-1;break}if(this.ld-=b[c].duration,c++,b[c].start(this.target),b[c].update(0),this.ld>0){if(b[c].isDone())continue;b[c].update(this.ld)}}this._last=c}}),b.Spwan=c.extend({init:function(a){for(var b=a instanceof Array?a:Array.prototype.slice.call(arguments,0),c=0,e=0,f=b.length;e<f;e++)b[e].duration>c&&(c=b[e].duration);this._actions=b,d.call(this,c)},update:function(a){this.fc?(this.fc=!1,this.clock=0):this.clock+=a;for(var b=this._actions,c=0,d=b.length;c<d;c++)0!=b[c].isRunning()&&(b[c].update(a),b[c].isDone()&&b[c].stop())},start:function(a){e.call(this,a);for(var b=0,c=this._actions.length;b<c;b++)this._actions[b].start(a)}}),b.RepeatForever=c.extend({init:function(a){d.call(this,a.duration),this._inner=a,this.ld=0},isDone:function(){return!1},start:function(a){e.call(this,a),this._inner.start(a),this.ld=0},update:function(a){var b=this._inner;this.fc?(this.fc=!1,this.clock=0,this.ld=0,a=0,b.start(this.target),b.update(0)):(this.clock+=a,this.ld+=a,b.update(a)),b.isDone()&&(b.stop(),b.start(this.target),b.update(0),this.ld=this.ld-this.duration,this.ld>0&&0==b.isDone()&&b.update(this.ld))}}),b.MoveBy=c.extend({init:function(a,b,c){d.call(this,a),this.dx=b,this.dy=c},start:function(a){e.call(this,a),this.x=a.x,this.y=a.y},step:function(a){this.target.pos(this.x+this.dx*a,this.y+this.dy*a)}}),b.MoveTo=c.extend({init:function(a,b,c){d.call(this,a),this.dx=b,this.dy=c},start:function(a){e.call(this,a),this.x=a.x,this.y=a.y,this.dx=this.dx-this.x,this.dy=this.dy-this.y},step:function(a){this.target.pos(this.x+this.dx*a,this.y+this.dy*a)}}),b.MoveXBy=c.extend({init:function(a,b){d.call(this,a),this.dx=b},start:function(a){e.call(this,a),this.x=a.x},step:function(a){this.target.posX(this.x+this.dx*a)}}),b.MoveXTo=c.extend({init:function(a,b){d.call(this,a),this.dx=b},start:function(a){e.call(this,a),this.x=a.x,this.dx=this.dx-this.x},step:function(a){this.target.posX(this.x+this.dx*a)}}),b.MoveYBy=c.extend({init:function(a,b){d.call(this,a),this.dy=b},start:function(a){e.call(this,a),this.y=a.y},step:function(a){this.target.posY(this.y+this.dy*a)}}),b.MoveYTo=c.extend({init:function(a,b){d.call(this,a),this.dy=y},start:function(a){e.call(this,a),this.y=a.y,this.dy=this.dy-this.y},step:function(a){this.target.posY(this.y+this.dy*a)}}),b.ScaleBy=c.extend({init:function(a,b,c){d.call(this,a),this.dsx=b,this.dsy=void 0===c?b:c},start:function(a){e.call(this,a),this.sx=a.scaleX,this.sy=a.scaleY,this.dsx=this.dsx*this.sx-this.sx,this.dsy=this.dsy*this.sy-this.sy},step:function(a){this.target.scale(this.sx+this.dsx*a,this.sy+this.dsy*a)}}),b.ScaleTo=c.extend({init:function(a,b,c){d.call(this,a),this.dsx=b,this.dsy=void 0===c?b:c},start:function(a){e.call(this,a),this.sx=a.scaleX,this.sy=a.scaleY,this.dsx=this.dsx-this.sx,this.dsy=this.dsy-this.sy},step:function(a){this.target.scale(this.sx+this.dsx*a,this.sy+this.dsy*a)}}),b.RotateTo=c.extend({init:function(a,b){d.call(this,a),this.dag=b},start:function(a){e.call(this,a),this.ag=a.rotation%360,this.dag=this.dag-this.ag,this.dag>180?this.dag-=360:this.dag<-180&&(this.dag+=360)},step:function(a){this.target.setRotation(this.ag+this.dag*a)}}),b.RotateBy=c.extend({init:function(a,b){d.call(this,a),this.dag=b},start:function(a){e.call(this,a),this.ag=a.rotation},step:function(a){this.target.setRotation(this.ag+this.dag*a)}}),b.JumpBy=c.extend({init:function(a,b,c,e,f){d.call(this,a),this.dx=b,this.dy=c,this.h=-e,this.jumps=f},start:function(a){e.call(this,a),this.x=a.x,this.y=a.y},step:function(a){var b=a*this.jumps%1,c=4*this.h*b*(1-b);c+=this.dy*a,this.target.pos(this.dx*a+this.x,this.y+c)}}),b.JumpTo=b.JumpBy.extend({init:function(a,c,d,e,f){b.JumpBy.prototype.init.call(this,a,c,d,e,f)},start:function(a){b.JumpBy.prototype.start.call(this,a),this.dx=this.dx-this.x,this.dy=this.dy-this.y}}),b.Blink=c.extend({init:function(a,b){d.call(this,a),this.times=b},start:function(a){e.call(this,a),this.origin=a.visible},stop:function(){this.target.setVisible(this.origin),c.prototype.stop.call(this)},step:function(a){var b=1/this.times,c=a%b;this.target.setVisible(c>b/2)}}),b.Delay=c.extend({}),b.FadeTo=c.extend({init:function(a,b){d.call(this,a),this.dopa=b},start:function(a){e.call(this,a),this.opa=a.opacity,this.dopa=this.dopa-this.opa},step:function(a){this.target.setOpacity(this.opa+this.dopa*a)}}),b.ActionInstant=b.Action.extend({init:function(){this.target=null,this.clock=0,this.duration=0},start:function(a){this.target=a,this.clock=0},isDone:function(){return!0},stop:function(){this.target=null},isRunning:function(){return null!=this.target},update:function(a){},step:function(a){}});var f=b.ActionInstant;b.Show=f.extend({update:function(a){this.target.setVisible(!0)}}),b.Hide=f.extend({update:function(a){this.target.setVisible(!1)}}),b.Place=f.extend({init:function(a,b){f.prototype.init.call(this),this.x=a,this.y=b},update:function(a){this.target.pos(this.x,this.y)}}),b.Callfunc=f.extend({init:function(a){f.prototype.init.call(this),this.func=a},update:function(a){this.func.call(this.target)}}),b.RemoveSelf=f.extend({update:function(a){this.target.removeFromParent()}});var g=b.ActionEasy,h=b.ActionEasy.prototype.init;b.EasyIn=g.extend({init:function(a,b){h.call(this,a),this.rate=void 0===b?2:b},step:function(a){this.inner.step(Math.pow(a,this.rate))}}),b.EasyOut=g.extend({init:function(a,b){h.call(this,a),this.rate=void 0===b?2:b},step:function(a){this.inner.step(Math.pow(a,1/this.rate))}}),b.EasyInOut=g.extend({init:function(a,b){h.call(this,a),this.rate=void 0===b?2:b},step:function(a){a*=2,a<1?this.inner.step(.5*Math.pow(a,this.rate)):this.inner.step(1-.5*Math.pow(2-a,this.rate))}}),b.EaseExponentialIn=g.extend({step:function(a){a=0==a?0:Math.pow(2,10*(a/1-1))-.001,this.inner.step(a)}}),b.EaseExponentialOut=g.extend({step:function(a){a=1==a?1:1-Math.pow(2,-10*a/1),this.inner.step(a)}}),b.EaseExponentialInOut=g.extend({step:function(a){a/=.5,a=a<1?.5*Math.pow(2,10*(a-1)):.5*(2-Math.pow(2,-10*(a-1))),this.inner.step(a)}}),b.EaseSineIn=g.extend({step:function(a){a=-1*Math.cos(a*Math.PI/2)+1,this.inner.step(a)}}),b.EaseSineOut=g.extend({step:function(a){a=Math.sin(a*Math.PI/2),this.inner.step(a)}}),b.EaseSineInOut=g.extend({step:function(a){a=-.5*(Math.cos(a*Math.PI)-1),this.inner.step(a)}}),b.EaseElasticIn=g.extend({init:function(a,b){h.call(this,a),this.period=void 0===b?.3:b},step:function(a){var b=0;if(0==a||1==a)b=a;else{var c=this.period/4;a-=1,b=-Math.pow(2,10*a)*Math.sin((a-c)*Math.PI/2/this.period)}this.inner.step(b)}}),b.EaseElasticOut=g.extend({init:function(a,b){h.call(this,a),this.period=void 0===b?.3:b},step:function(a){var b=0;if(0==a||1==a)b=a;else{var c=this.period/4;b=Math.pow(2,-10*a)*Math.sin((a-c)*Math.PI/2/this.period)+1}this.inner.step(b)}}),b.EaseElasticInOut=g.extend({init:function(a,b){h.call(this,a),this.period=void 0===b?.3:b/1e3},step:function(a){var b=0;if(0==a||1==a)b=a;else{a*=2,this.period||(this.period=.3*1.5);var c=this.period/4;a-=1,b=a<0?-.5*Math.pow(2,10*a)*Math.sin((a-c)*Math.PI/2/this.period):Math.pow(2,-10*a)*Math.sin((a-c)*Math.PI/2/this.period)*.5+1}this.inner.step(b)}}),function(){function a(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375}b.BounceEaseIn=g.extend({init:function(a){h.call(this,a),this.period="undefined"==typeof period?.3:period/1e3},step:function(b){this.inner.step(1-a(1-b))}}),b.BounceEaseOut=g.extend({step:function(b){this.inner.step(a(b))}}),b.BounceEaseInOut=g.extend({step:function(b){var c=0;b<.5?(b*=2,c=.5*(1-a(1-b))):c=.5*a(2*b-1)+.5,this.inner.step(c)}})}(),b.BackEaseIn=g.extend({step:function(a){this.inner.step(a*a*(2.70158*a-1.70158))}}),b.BackEaseOut=g.extend({step:function(a){a-=1,this.inner.step(a*a*(2.70158*a+1.70158)+1)}}),b.BackEaseInOut=g.extend({step:function(a){var b=0;a*=2,a<1?b=a*a*(3.5949095*a-2.5949095)/2:(a-=2,b=a*a*(3.5949095*a+2.5949095)/2+1),this.inner.step(b)}}),b.MouseEvent=function(a,b,c,d){this.orign=a,this.type=d,this.x=b,this.y=c,this.swallowed=!1},b.MouseEvent.prototype.swallow=function(){this.swallowed=!0},b.KeyboardEvent=function(a,b,c,d){this.orign=a,this.type=d,this.keyCode=c,this.charCode=a.charCode,this.key=b,this.altKey=a.altKey,this.shiftKey=a.shiftKey,this.ctrlKey=a.ctrlKey,this.swallowed=!1},b.KeyboardEvent.prototype.swallow=function(){this.swallowed=!0},b.DebugFps=b.Node.extend({init:function(a){b.Node.prototype.init.call(this),this.anchor(0).size(160,42),this.font=new b.Sysfont("microsoft yahei",12,"#FFF"),this.director=a},draw:function(a){a.fillStyle="rgba(0, 0, 0)",a.fillRect(0,0,this.w,this.h);var b=this.director.debugData;this.font.beginDraw(a,"left","middle"),this.font.fillText(a,"udt: "+b.updateTime.toFixed(2),0,7),this.font.fillText(a,"draw: "+b.drawTime.toFixed(2),0,21),this.font.fillText(a,"objs: "+b.objs,0,35),this.font.fillText(a,"draws: "+b.draws,90,35),this.font.fillText(a,"fps: "+b.fps,90,7),this.font.fillText(a,"dfps: "+b.drawFps,90,21)}})}(window,window.le);